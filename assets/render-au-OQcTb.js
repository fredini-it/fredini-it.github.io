var Vt=Object.defineProperty;var Kt=(c,e,t)=>e in c?Vt(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var Fe=(c,e,t)=>Kt(c,typeof e!="symbol"?e+"":e,t);import"./modulepreload-polyfill-B5Qt9EMX.js";import*as f from"three";import{Controls as Wt,Vector3 as F,MOUSE as fe,TOUCH as pe,Quaternion as ve,Spherical as nt,Vector2 as j,Ray as Xt,Plane as Yt,MathUtils as qe,WebGLRenderer as Zt,PCFSoftShadowMap as qt,TrianglesDrawMode as Jt,TriangleFanDrawMode as Ue,TriangleStripDrawMode as Ct,Loader as xt,LoaderUtils as we,FileLoader as Re,MeshPhysicalMaterial as J,Color as ae,LinearSRGBColorSpace as q,SRGBColorSpace as se,SpotLight as Qt,PointLight as ei,DirectionalLight as Mt,Matrix4 as Le,InstancedMesh as ti,InstancedBufferAttribute as ii,Object3D as St,TextureLoader as ni,ImageBitmapLoader as si,BufferAttribute as Te,InterleavedBuffer as ai,InterleavedBufferAttribute as oi,LinearMipmapLinearFilter as vt,NearestMipmapLinearFilter as ri,LinearMipmapNearestFilter as li,NearestMipmapNearestFilter as ci,LinearFilter as $e,NearestFilter as Rt,RepeatWrapping as Ve,MirroredRepeatWrapping as hi,ClampToEdgeWrapping as di,PointsMaterial as ui,Material as De,LineBasicMaterial as Lt,MeshStandardMaterial as kt,DoubleSide as Pt,MeshBasicMaterial as le,PropertyBinding as mi,BufferGeometry as Ae,SkinnedMesh as pi,Mesh as ke,LineSegments as fi,Line as gi,LineLoop as Ke,Points as bi,Group as ce,PerspectiveCamera as yi,OrthographicCamera as _i,Skeleton as wi,AnimationClip as Ti,Bone as Ai,InterpolateDiscrete as Ei,InterpolateLinear as Ft,Texture as st,VectorKeyframeTrack as at,NumberKeyframeTrack as ot,QuaternionKeyframeTrack as rt,ColorManagement as We,FrontSide as Ci,Interpolant as xi,Box3 as Mi,Sphere as Si,ShaderMaterial as vi,BackSide as Ri,UniformsUtils as Li,BoxGeometry as ki,SphereGeometry as Pi,LineDashedMaterial as Fi,Float32BufferAttribute as Oe}from"three";import Di from"stats-gl";const lt={type:"change"},Je={type:"start"},Dt={type:"end"},Se=new Xt,ct=new Yt,Oi=Math.cos(70*qe.DEG2RAD),N=new F,G=2*Math.PI,v={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Ie=1e-6;class Ii extends Wt{constructor(e,t=null){super(e,t),this.state=v.NONE,this.enabled=!0,this.target=new F,this.cursor=new F,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:fe.ROTATE,MIDDLE:fe.DOLLY,RIGHT:fe.PAN},this.touches={ONE:pe.ROTATE,TWO:pe.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new F,this._lastQuaternion=new ve,this._lastTargetPosition=new F,this._quat=new ve().setFromUnitVectors(e.up,new F(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new nt,this._sphericalDelta=new nt,this._scale=1,this._panOffset=new F,this._rotateStart=new j,this._rotateEnd=new j,this._rotateDelta=new j,this._panStart=new j,this._panEnd=new j,this._panDelta=new j,this._dollyStart=new j,this._dollyEnd=new j,this._dollyDelta=new j,this._dollyDirection=new F,this._mouse=new j,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Hi.bind(this),this._onPointerDown=Ni.bind(this),this._onPointerUp=Bi.bind(this),this._onContextMenu=Ki.bind(this),this._onMouseWheel=ji.bind(this),this._onKeyDown=Ui.bind(this),this._onTouchStart=$i.bind(this),this._onTouchMove=Vi.bind(this),this._onMouseDown=zi.bind(this),this._onMouseMove=Gi.bind(this),this._interceptControlDown=Wi.bind(this),this._interceptControlUp=Xi.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(lt),this.update(),this.state=v.NONE}update(e=null){const t=this.object.position;N.copy(t).sub(this.target),N.applyQuaternion(this._quat),this._spherical.setFromVector3(N),this.autoRotate&&this.state===v.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(i)&&isFinite(n)&&(i<-Math.PI?i+=G:i>Math.PI&&(i-=G),n<-Math.PI?n+=G:n>Math.PI&&(n-=G),i<=n?this._spherical.theta=Math.max(i,Math.min(n,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+n)/2?Math.max(i,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let a=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const s=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),a=s!=this._spherical.radius}if(N.setFromSpherical(this._spherical),N.applyQuaternion(this._quatInverse),t.copy(this.target).add(N),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let s=null;if(this.object.isPerspectiveCamera){const r=N.length();s=this._clampDistance(r*this._scale);const o=r-s;this.object.position.addScaledVector(this._dollyDirection,o),this.object.updateMatrixWorld(),a=!!o}else if(this.object.isOrthographicCamera){const r=new F(this._mouse.x,this._mouse.y,0);r.unproject(this.object);const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),a=o!==this.object.zoom;const l=new F(this._mouse.x,this._mouse.y,0);l.unproject(this.object),this.object.position.sub(l).add(r),this.object.updateMatrixWorld(),s=N.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;s!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(s).add(this.object.position):(Se.origin.copy(this.object.position),Se.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Se.direction))<Oi?this.object.lookAt(this.target):(ct.setFromNormalAndCoplanarPoint(this.object.up,this.target),Se.intersectPlane(ct,this.target))))}else if(this.object.isOrthographicCamera){const s=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),s!==this.object.zoom&&(this.object.updateProjectionMatrix(),a=!0)}return this._scale=1,this._performCursorZoom=!1,a||this._lastPosition.distanceToSquared(this.object.position)>Ie||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Ie||this._lastTargetPosition.distanceToSquared(this.target)>Ie?(this.dispatchEvent(lt),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?G/60*this.autoRotateSpeed*e:G/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){N.setFromMatrixColumn(t,0),N.multiplyScalar(-e),this._panOffset.add(N)}_panUp(e,t){this.screenSpacePanning===!0?N.setFromMatrixColumn(t,1):(N.setFromMatrixColumn(t,0),N.crossVectors(this.object.up,N)),N.multiplyScalar(e),this._panOffset.add(N)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;N.copy(n).sub(this.target);let a=N.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*a/i.clientHeight,this.object.matrix),this._panUp(2*t*a/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),n=e-i.left,a=t-i.top,s=i.width,r=i.height;this._mouse.x=n/s*2-1,this._mouse.y=-(a/r)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(G*this._rotateDelta.x/t.clientHeight),this._rotateUp(G*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(G*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-G*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(G*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-G*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateStart.set(i,n)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panStart.set(i,n)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,a=Math.sqrt(i*i+n*n);this._dollyStart.set(0,a)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),a=.5*(e.pageY+i.y);this._rotateEnd.set(n,a)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(G*this._rotateDelta.x/t.clientHeight),this._rotateUp(G*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panEnd.set(i,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,a=Math.sqrt(i*i+n*n);this._dollyEnd.set(0,a),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const s=(e.pageX+t.x)*.5,r=(e.pageY+t.y)*.5;this._updateZoomParameters(s,r)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new j,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function Ni(c){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(c.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(c)&&(this._addPointer(c),c.pointerType==="touch"?this._onTouchStart(c):this._onMouseDown(c)))}function Hi(c){this.enabled!==!1&&(c.pointerType==="touch"?this._onTouchMove(c):this._onMouseMove(c))}function Bi(c){switch(this._removePointer(c),this._pointers.length){case 0:this.domElement.releasePointerCapture(c.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Dt),this.state=v.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function zi(c){let e;switch(c.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case fe.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(c),this.state=v.DOLLY;break;case fe.ROTATE:if(c.ctrlKey||c.metaKey||c.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(c),this.state=v.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(c),this.state=v.ROTATE}break;case fe.PAN:if(c.ctrlKey||c.metaKey||c.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(c),this.state=v.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(c),this.state=v.PAN}break;default:this.state=v.NONE}this.state!==v.NONE&&this.dispatchEvent(Je)}function Gi(c){switch(this.state){case v.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(c);break;case v.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(c);break;case v.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(c);break}}function ji(c){this.enabled===!1||this.enableZoom===!1||this.state!==v.NONE||(c.preventDefault(),this.dispatchEvent(Je),this._handleMouseWheel(this._customWheelEvent(c)),this.dispatchEvent(Dt))}function Ui(c){this.enabled!==!1&&this._handleKeyDown(c)}function $i(c){switch(this._trackPointer(c),this._pointers.length){case 1:switch(this.touches.ONE){case pe.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(c),this.state=v.TOUCH_ROTATE;break;case pe.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(c),this.state=v.TOUCH_PAN;break;default:this.state=v.NONE}break;case 2:switch(this.touches.TWO){case pe.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(c),this.state=v.TOUCH_DOLLY_PAN;break;case pe.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(c),this.state=v.TOUCH_DOLLY_ROTATE;break;default:this.state=v.NONE}break;default:this.state=v.NONE}this.state!==v.NONE&&this.dispatchEvent(Je)}function Vi(c){switch(this._trackPointer(c),this.state){case v.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(c),this.update();break;case v.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(c),this.update();break;case v.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(c),this.update();break;case v.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(c),this.update();break;default:this.state=v.NONE}}function Ki(c){this.enabled!==!1&&c.preventDefault()}function Wi(c){c.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Xi(c){c.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function ht(c,e){const t=new Ii(c,e);return t.enableDamping=!0,t.autoRotate=!1,t.minDistance=1,t.maxDistance=100,t.tick=()=>t.update(),t}function Yi(c,e){const t=c.addFolder("Cameras"),i=e.params,n=e.controls,a={firstPerson:!1,birdView:!1};let s,r=0,o=!1,l=!1,h=0,d=0;const u=.002;function m(g){o&&(l=!0,h=g.clientX,d=g.clientY,g.preventDefault())}function p(g){if(o&&l){const T=g.clientX-h,A=g.clientY-d;h=g.clientX,d=g.clientY,e.camera.rotation.y-=T*u,e.camera.rotation.x-=A*u,e.camera.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,e.camera.rotation.x))}}function _(){l=!1}const b=e.renderer.domElement;b.addEventListener("mousedown",m),b.addEventListener("mousemove",p),b.addEventListener("mouseup",_);function w(){s&&(s.destroy(),s=null);const g=e.sceneManager.availableCameras.map((T,A)=>T.name||`Camera ${A}`);g.length>0&&(i.selectedCamera=g[r],s=t.add(i,"selectedCamera",g).name("Select Camera").onChange(T=>{const A=g.indexOf(T);r=A;const S=e.sceneManager.availableCameras[A];e.camera.position.copy(S.position),e.camera.quaternion.copy(S.quaternion),e.camera.fov=S.fov,e.camera.updateProjectionMatrix(),e.sceneManager.targetPosition&&n.target.copy(e.sceneManager.targetPosition),n.update()}))}return t.add({resetCamera:()=>{if(e.sceneManager.availableCameras.length>0){const g=e.sceneManager.availableCameras[0];e.camera.position.copy(g.position),e.camera.quaternion.copy(g.quaternion),e.camera.fov=g.fov,e.camera.updateProjectionMatrix(),e.sceneManager.targetPosition&&n.target.copy(e.sceneManager.targetPosition),n.update(),r=0,i.selectedCamera=e.sceneManager.availableCameras[0].name||"Camera 0",s&&s.updateDisplay()}}},"resetCamera").name("Reset Camera"),t.add(n,"autoRotate").name("Auto Rotate"),t.add(a,"firstPerson").name("First Person").onChange(g=>{if(o=g,g)a.birdView=!1,n.enabled=!1,e.car||console.warn("Car not loaded; maintaining current position");else if(n.enabled=!0,e.sceneManager.availableCameras.length>0){const T=e.sceneManager.availableCameras[r];e.camera.position.copy(T.position),e.camera.quaternion.copy(T.quaternion),e.camera.fov=T.fov,e.camera.updateProjectionMatrix(),e.sceneManager.targetPosition&&n.target.copy(e.sceneManager.targetPosition),n.update()}else console.warn("No cameras available, using fallback"),e.camera.position.set(-5,5,5),e.camera.updateProjectionMatrix(),n.update()}),t.add(a,"birdView").name("Bird View").onChange(g=>{if(g){a.firstPerson=!1,o=!1,n.enabled=!0;const T=new f.Box3().setFromObject(e.car||new f.Object3D),A=T.max.y-T.min.y;e.camera.position.set(0,T.min.y+A*10,0),e.sceneManager.targetPosition&&n.target.copy(e.sceneManager.targetPosition),n.update()}}),{updateCameraControls:w}}/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.17.0
 * @author George Michael Brower
 * @license MIT
 */class Z{constructor(e,t,i,n,a="div"){this.parent=e,this.object=t,this.property=i,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(n),this.$name=document.createElement("div"),this.$name.classList.add("name"),Z.nextNameID=Z.nextNameID||0,this.$name.id="lil-gui-name-"+ ++Z.nextNameID,this.$widget=document.createElement(a),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(e){return this._name=e,this.$name.innerHTML=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e===this._disabled||(this._disabled=e,this.domElement.classList.toggle("disabled",e),this.$disable.toggleAttribute("disabled",e)),this}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(e){const t=this.parent.add(this.object,this.property,e);return t.name(this._name),this.destroy(),t}min(e){return this}max(e){return this}step(e){return this}decimals(e){return this}listen(e=!0){return this._listening=e,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const e=this.save();e!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=e}getValue(){return this.object[this.property]}setValue(e){return this.object[this.property]=e,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(e){return this.setValue(e),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class Zi extends Z{constructor(e,t,i){super(e,t,i,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function Xe(c){let e,t;return(e=c.match(/(#|0x)?([a-f0-9]{6})/i))?t=e[2]:(e=c.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?t=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=c.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(t=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!t&&"#"+t}const qi={isPrimitive:!0,match:c=>typeof c=="string",fromHexString:Xe,toHexString:Xe},Ee={isPrimitive:!0,match:c=>typeof c=="number",fromHexString:c=>parseInt(c.substring(1),16),toHexString:c=>"#"+c.toString(16).padStart(6,0)},Ji={isPrimitive:!1,match:Array.isArray,fromHexString(c,e,t=1){const i=Ee.fromHexString(c);e[0]=(i>>16&255)/255*t,e[1]=(i>>8&255)/255*t,e[2]=(255&i)/255*t},toHexString:([c,e,t],i=1)=>Ee.toHexString(c*(i=255/i)<<16^e*i<<8^t*i<<0)},Qi={isPrimitive:!1,match:c=>Object(c)===c,fromHexString(c,e,t=1){const i=Ee.fromHexString(c);e.r=(i>>16&255)/255*t,e.g=(i>>8&255)/255*t,e.b=(255&i)/255*t},toHexString:({r:c,g:e,b:t},i=1)=>Ee.toHexString(c*(i=255/i)<<16^e*i<<8^t*i<<0)},en=[qi,Ee,Ji,Qi];class tn extends Z{constructor(e,t,i,n){var a;super(e,t,i,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(a=this.initialValue,en.find(s=>s.match(a))),this._rgbScale=n,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const s=Xe(this.$text.value);s&&this._setValueFromHexString(s)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){if(this._format.isPrimitive){const t=this._format.fromHexString(e);this.setValue(t)}else this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){return this._setValueFromHexString(e),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class Ne extends Z{constructor(e,t,i){super(e,t,i,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",n=>{n.preventDefault(),this.getValue().call(this.object)}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class nn extends Z{constructor(e,t,i,n,a,s){super(e,t,i,"number"),this._initInput(),this.min(n),this.max(a);const r=s!==void 0;this.step(r?s:this._getImplicitStep(),r),this.updateDisplay()}decimals(e){return this._decimals=e,this.updateDisplay(),this}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,t=!0){return this._step=e,this._stepExplicit=t,this}updateDisplay(){const e=this.getValue();if(this._hasSlider){let t=(e-this._min)/(this._max-this._min);t=Math.max(0,Math.min(t,1)),this.$fill.style.width=100*t+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?e:e.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const e=h=>{const d=parseFloat(this.$input.value);isNaN(d)||(this._snapClampSetValue(d+h),this.$input.value=this.getValue())};let t,i,n,a,s,r=!1;const o=h=>{if(r){const d=h.clientX-t,u=h.clientY-i;Math.abs(u)>5?(h.preventDefault(),this.$input.blur(),r=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(d)>5&&l()}if(!r){const d=h.clientY-n;s-=d*this._step*this._arrowKeyMultiplier(h),a+s>this._max?s=this._max-a:a+s<this._min&&(s=this._min-a),this._snapClampSetValue(a+s)}n=h.clientY},l=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",l)};this.$input.addEventListener("input",()=>{let h=parseFloat(this.$input.value);isNaN(h)||(this._stepExplicit&&(h=this._snap(h)),this.setValue(this._clamp(h)))}),this.$input.addEventListener("keydown",h=>{h.code==="Enter"&&this.$input.blur(),h.code==="ArrowUp"&&(h.preventDefault(),e(this._step*this._arrowKeyMultiplier(h))),h.code==="ArrowDown"&&(h.preventDefault(),e(this._step*this._arrowKeyMultiplier(h)*-1))}),this.$input.addEventListener("wheel",h=>{this._inputFocused&&(h.preventDefault(),e(this._step*this._normalizeMouseWheel(h)))},{passive:!1}),this.$input.addEventListener("mousedown",h=>{t=h.clientX,i=n=h.clientY,r=!0,a=this.getValue(),s=0,window.addEventListener("mousemove",o),window.addEventListener("mouseup",l)}),this.$input.addEventListener("focus",()=>{this._inputFocused=!0}),this.$input.addEventListener("blur",()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()})}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const e=u=>{const m=this.$slider.getBoundingClientRect();let p=(_=u,b=m.left,w=m.right,g=this._min,T=this._max,(_-b)/(w-b)*(T-g)+g);var _,b,w,g,T;this._snapClampSetValue(p)},t=u=>{e(u.clientX)},i=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",i)};let n,a,s=!1;const r=u=>{u.preventDefault(),this._setDraggingStyle(!0),e(u.touches[0].clientX),s=!1},o=u=>{if(s){const m=u.touches[0].clientX-n,p=u.touches[0].clientY-a;Math.abs(m)>Math.abs(p)?r(u):(window.removeEventListener("touchmove",o),window.removeEventListener("touchend",l))}else u.preventDefault(),e(u.touches[0].clientX)},l=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",l)},h=this._callOnFinishChange.bind(this);let d;this.$slider.addEventListener("mousedown",u=>{this._setDraggingStyle(!0),e(u.clientX),window.addEventListener("mousemove",t),window.addEventListener("mouseup",i)}),this.$slider.addEventListener("touchstart",u=>{u.touches.length>1||(this._hasScrollBar?(n=u.touches[0].clientX,a=u.touches[0].clientY,s=!0):r(u),window.addEventListener("touchmove",o,{passive:!1}),window.addEventListener("touchend",l))},{passive:!1}),this.$slider.addEventListener("wheel",u=>{if(Math.abs(u.deltaX)<Math.abs(u.deltaY)&&this._hasScrollBar)return;u.preventDefault();const m=this._normalizeMouseWheel(u)*this._step;this._snapClampSetValue(this.getValue()+m),this.$input.value=this.getValue(),clearTimeout(d),d=setTimeout(h,400)},{passive:!1})}_setDraggingStyle(e,t="horizontal"){this.$slider&&this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-dragging",e),document.body.classList.toggle("lil-gui-"+t,e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:t,deltaY:i}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(t=0,i=-e.wheelDelta/120,i*=this._stepExplicit?1:10),t+-i}_arrowKeyMultiplier(e){let t=this._stepExplicit?1:10;return e.shiftKey?t*=10:e.altKey&&(t/=10),t}_snap(e){const t=Math.round(e/this._step)*this._step;return parseFloat(t.toPrecision(15))}_clamp(e){return e<this._min&&(e=this._min),e>this._max&&(e=this._max),e}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){const e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class sn extends Z{constructor(e,t,i,n){super(e,t,i,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(n)?n:Object.values(n),this._names=Array.isArray(n)?n:Object.keys(n),this._names.forEach(a=>{const s=document.createElement("option");s.innerHTML=a,this.$select.appendChild(s)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const e=this.getValue(),t=this._values.indexOf(e);return this.$select.selectedIndex=t,this.$display.innerHTML=t===-1?e:this._names[t],this}}class an extends Z{constructor(e,t,i){super(e,t,i,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",n=>{n.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let dt=!1;class Qe{constructor({parent:e,autoPlace:t=e===void 0,container:i,width:n,title:a="Controls",injectStyles:s=!0,touchStyles:r=!0}={}){if(this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",o=>{o.code!=="Enter"&&o.code!=="Space"||(o.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(a),r&&this.domElement.classList.add("allow-touch-styles"),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),!dt&&s&&(function(o){const l=document.createElement("style");l.innerHTML=o;const h=document.querySelector("head link[rel=stylesheet], head style");h?document.head.insertBefore(l,h):document.head.appendChild(l)}('.lil-gui{--background-color:#1f1f1f;--text-color:#ebebeb;--title-background-color:#111;--title-text-color:#ebebeb;--widget-color:#424242;--hover-color:#4f4f4f;--focus-color:#595959;--number-color:#2cc9ff;--string-color:#a2db3c;--font-size:11px;--input-font-size:11px;--font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;--font-family-mono:Menlo,Monaco,Consolas,"Droid Sans Mono",monospace;--padding:4px;--spacing:4px;--widget-height:20px;--name-width:45%;--slider-knob-width:2px;--slider-input-width:27%;--color-input-width:27%;--slider-input-min-width:45px;--color-input-min-width:45px;--folder-indent:7px;--widget-padding:0 0 0 3px;--widget-border-radius:2px;--checkbox-size:calc(var(--widget-height)*0.75);--scrollbar-width:5px;background-color:var(--background-color);color:var(--text-color);font-family:var(--font-family);font-size:var(--font-size);font-style:normal;font-weight:400;line-height:1;text-align:left;touch-action:manipulation;user-select:none;-webkit-user-select:none}.lil-gui,.lil-gui *{box-sizing:border-box;margin:0;padding:0}.lil-gui.root{display:flex;flex-direction:column;width:var(--width,245px)}.lil-gui.root>.title{background:var(--title-background-color);color:var(--title-text-color)}.lil-gui.root>.children{overflow-x:hidden;overflow-y:auto}.lil-gui.root>.children::-webkit-scrollbar{background:var(--background-color);height:var(--scrollbar-width);width:var(--scrollbar-width)}.lil-gui.root>.children::-webkit-scrollbar-thumb{background:var(--focus-color);border-radius:var(--scrollbar-width)}.lil-gui.force-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}.lil-gui.autoPlace{max-height:100%;position:fixed;right:15px;top:0;z-index:1001}.lil-gui .controller{align-items:center;display:flex;margin:var(--spacing) 0;padding:0 var(--padding)}.lil-gui .controller.disabled{opacity:.5}.lil-gui .controller.disabled,.lil-gui .controller.disabled *{pointer-events:none!important}.lil-gui .controller>.name{flex-shrink:0;line-height:var(--widget-height);min-width:var(--name-width);padding-right:var(--spacing);white-space:pre}.lil-gui .controller .widget{align-items:center;display:flex;min-height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.string input{color:var(--string-color)}.lil-gui .controller.boolean .widget{cursor:pointer}.lil-gui .controller.color .display{border-radius:var(--widget-border-radius);height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.color input[type=color]{cursor:pointer;height:100%;opacity:0;width:100%}.lil-gui .controller.color input[type=text]{flex-shrink:0;font-family:var(--font-family-mono);margin-left:var(--spacing);min-width:var(--color-input-min-width);width:var(--color-input-width)}.lil-gui .controller.option select{max-width:100%;opacity:0;position:absolute;width:100%}.lil-gui .controller.option .display{background:var(--widget-color);border-radius:var(--widget-border-radius);height:var(--widget-height);line-height:var(--widget-height);max-width:100%;overflow:hidden;padding-left:.55em;padding-right:1.75em;pointer-events:none;position:relative;word-break:break-all}.lil-gui .controller.option .display.active{background:var(--focus-color)}.lil-gui .controller.option .display:after{bottom:0;content:"↕";font-family:lil-gui;padding-right:.375em;position:absolute;right:0;top:0}.lil-gui .controller.option .widget,.lil-gui .controller.option select{cursor:pointer}.lil-gui .controller.number input{color:var(--number-color)}.lil-gui .controller.number.hasSlider input{flex-shrink:0;margin-left:var(--spacing);min-width:var(--slider-input-min-width);width:var(--slider-input-width)}.lil-gui .controller.number .slider{background-color:var(--widget-color);border-radius:var(--widget-border-radius);cursor:ew-resize;height:var(--widget-height);overflow:hidden;padding-right:var(--slider-knob-width);touch-action:pan-y;width:100%}.lil-gui .controller.number .slider.active{background-color:var(--focus-color)}.lil-gui .controller.number .slider.active .fill{opacity:.95}.lil-gui .controller.number .fill{border-right:var(--slider-knob-width) solid var(--number-color);box-sizing:content-box;height:100%}.lil-gui-dragging .lil-gui{--hover-color:var(--widget-color)}.lil-gui-dragging *{cursor:ew-resize!important}.lil-gui-dragging.lil-gui-vertical *{cursor:ns-resize!important}.lil-gui .title{--title-height:calc(var(--widget-height) + var(--spacing)*1.25);-webkit-tap-highlight-color:transparent;text-decoration-skip:objects;cursor:pointer;font-weight:600;height:var(--title-height);line-height:calc(var(--title-height) - 4px);outline:none;padding:0 var(--padding)}.lil-gui .title:before{content:"▾";display:inline-block;font-family:lil-gui;padding-right:2px}.lil-gui .title:active{background:var(--title-background-color);opacity:.75}.lil-gui.root>.title:focus{text-decoration:none!important}.lil-gui.closed>.title:before{content:"▸"}.lil-gui.closed>.children{opacity:0;transform:translateY(-7px)}.lil-gui.closed:not(.transition)>.children{display:none}.lil-gui.transition>.children{overflow:hidden;pointer-events:none;transition-duration:.3s;transition-property:height,opacity,transform;transition-timing-function:cubic-bezier(.2,.6,.35,1)}.lil-gui .children:empty:before{content:"Empty";display:block;font-style:italic;height:var(--widget-height);line-height:var(--widget-height);margin:var(--spacing) 0;opacity:.5;padding:0 var(--padding)}.lil-gui.root>.children>.lil-gui>.title{border-width:0;border-bottom:1px solid var(--widget-color);border-left:0 solid var(--widget-color);border-right:0 solid var(--widget-color);border-top:1px solid var(--widget-color);transition:border-color .3s}.lil-gui.root>.children>.lil-gui.closed>.title{border-bottom-color:transparent}.lil-gui+.controller{border-top:1px solid var(--widget-color);margin-top:0;padding-top:var(--spacing)}.lil-gui .lil-gui .lil-gui>.title{border:none}.lil-gui .lil-gui .lil-gui>.children{border:none;border-left:2px solid var(--widget-color);margin-left:var(--folder-indent)}.lil-gui .lil-gui .controller{border:none}.lil-gui input{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:0;border-radius:var(--widget-border-radius);color:var(--text-color);font-family:var(--font-family);font-size:var(--input-font-size);height:var(--widget-height);outline:none;width:100%}.lil-gui input:disabled{opacity:1}.lil-gui input[type=number],.lil-gui input[type=text]{padding:var(--widget-padding)}.lil-gui input[type=number]:focus,.lil-gui input[type=text]:focus{background:var(--focus-color)}.lil-gui input::-webkit-inner-spin-button,.lil-gui input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.lil-gui input[type=number]{-moz-appearance:textfield}.lil-gui input[type=checkbox]{appearance:none;-webkit-appearance:none;border-radius:var(--widget-border-radius);cursor:pointer;height:var(--checkbox-size);text-align:center;width:var(--checkbox-size)}.lil-gui input[type=checkbox]:checked:before{content:"✓";font-family:lil-gui;font-size:var(--checkbox-size);line-height:var(--checkbox-size)}.lil-gui button{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:1px solid var(--widget-color);border-radius:var(--widget-border-radius);color:var(--text-color);cursor:pointer;font-family:var(--font-family);font-size:var(--font-size);height:var(--widget-height);line-height:calc(var(--widget-height) - 4px);outline:none;text-align:center;text-transform:none;width:100%}.lil-gui button:active{background:var(--focus-color)}@font-face{font-family:lil-gui;src:url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff")}@media (pointer:coarse){.lil-gui.allow-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}}@media (hover:hover){.lil-gui .controller.color .display:hover:before{border:1px solid #fff9;border-radius:var(--widget-border-radius);bottom:0;content:" ";display:block;left:0;position:absolute;right:0;top:0}.lil-gui .controller.option .display.focus{background:var(--focus-color)}.lil-gui .controller.option .widget:hover .display{background:var(--hover-color)}.lil-gui .controller.number .slider:hover{background-color:var(--hover-color)}body:not(.lil-gui-dragging) .lil-gui .title:hover{background:var(--title-background-color);opacity:.85}.lil-gui .title:focus{text-decoration:underline var(--focus-color)}.lil-gui input:hover{background:var(--hover-color)}.lil-gui input:active{background:var(--focus-color)}.lil-gui input[type=checkbox]:focus{box-shadow:inset 0 0 0 1px var(--focus-color)}.lil-gui button:hover{background:var(--hover-color);border-color:var(--hover-color)}.lil-gui button:focus{border-color:var(--focus-color)}}'),dt=!0),i?i.appendChild(this.domElement):t&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),n&&this.domElement.style.setProperty("--width",n+"px"),this.domElement.addEventListener("keydown",o=>o.stopPropagation()),this.domElement.addEventListener("keyup",o=>o.stopPropagation())}add(e,t,i,n,a){if(Object(i)===i)return new sn(this,e,t,i);const s=e[t];switch(typeof s){case"number":return new nn(this,e,t,i,n,a);case"boolean":return new Zi(this,e,t);case"string":return new an(this,e,t);case"function":return new Ne(this,e,t)}console.error(`gui.add failed
	property:`,t,`
	object:`,e,`
	value:`,s)}addColor(e,t,i=1){return new tn(this,e,t,i)}addFolder(e){return new Qe({parent:this,title:e})}load(e,t=!0){return e.controllers&&this.controllers.forEach(i=>{i instanceof Ne||i._name in e.controllers&&i.load(e.controllers[i._name])}),t&&e.folders&&this.folders.forEach(i=>{i._title in e.folders&&i.load(e.folders[i._title])}),this}save(e=!0){const t={controllers:{},folders:{}};return this.controllers.forEach(i=>{if(!(i instanceof Ne)){if(i._name in t.controllers)throw new Error(`Cannot save GUI with duplicate property "${i._name}"`);t.controllers[i._name]=i.save()}}),e&&this.folders.forEach(i=>{if(i._title in t.folders)throw new Error(`Cannot save GUI with duplicate folder "${i._title}"`);t.folders[i._title]=i.save()}),t}open(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const t=this.$children.clientHeight;this.$children.style.height=t+"px",this.domElement.classList.add("transition");const i=a=>{a.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",i))};this.$children.addEventListener("transitionend",i);const n=e?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!e),requestAnimationFrame(()=>{this.$children.style.height=n+"px"})}),this}title(e){return this._title=e,this.$title.innerHTML=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach(t=>t.reset()),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),this._onChange!==void 0&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(e){this.parent&&this.parent._callOnFinishChange(e),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(e=>e.destroy())}controllersRecursive(){let e=Array.from(this.controllers);return this.folders.forEach(t=>{e=e.concat(t.controllersRecursive())}),e}foldersRecursive(){let e=Array.from(this.folders);return this.folders.forEach(t=>{e=e.concat(t.foldersRecursive())}),e}}function on(c){const e=new Qe,t=c.params,i=c.lightingManager.ambientLight,n=c.lightingManager.sunHelper,a=c.lightingManager.shadowCameraHelper,s=c.lightingManager.sunPath,r=c.lightingManager.skyControl,o=c.lightingManager.setLightingMode.bind(c.lightingManager);function l(M,B){let he;return function(...Ce){clearTimeout(he),he=setTimeout(()=>M.apply(this,Ce),B)}}const h=e.addFolder("Car Selection"),d={vin:"ZF00"};h.add(d,"vin",["ZF00","ZF01","ZF02","ZF03","ZF04","ZF05"]).name("Select Car (VIN)").onChange(M=>c.sceneManager.reloadCar(M)),e.addFolder("Visualization Mode").add({mode:c.mode},"mode",["veloce","bellezza"]).name("Mode").onChange(l(M=>c.switchMode(M),100));const m={sunLight:t.lightingMode==="sun"||t.lightingMode==="both",sceneLight:t.lightingMode==="scene"||t.lightingMode==="both"};e.add(m,"sunLight").name("Sun Light").onChange(M=>{P(),H()}),e.add(m,"sceneLight").name("Scene Light").onChange(M=>{P(),H()});const p=e.addFolder("Scene"),_=["test","city","studio","showroom","poster1","poster2"];p.add(t,"currentScene",_).name("Select Scene").onChange(M=>{c.sceneManager.switchScene(M).then(()=>{b.updateCameraControls()})});const b=Yi(e,c);e.add(t,"exposure",0,2,.01).name("Exposure").onChange(M=>{c.rendererManager.setExposure(M,c.sceneManager.currentScene,i,c.lightingManager.dynamicSky)});const w={None:"NoToneMapping",Linear:"LinearToneMapping",Reinhard:"ReinhardToneMapping",Cineon:"CineonToneMapping","ACES Filmic":"ACESFilmicToneMapping",AgX:"AgXToneMapping",Neutral:"NeutralToneMapping",Custom:"CustomToneMapping"};t.toneMapping="LinearToneMapping",e.add(t,"toneMapping",Object.keys(w)).name("Tone Mapping").onChange(M=>{c.rendererManager.setToneMapping(w[M])});const g=e.addFolder("Sky");g.add(r,"turbidity",0,10,.1),g.add(r,"rayleigh",0,4,.1),g.add(r,"mieCoefficient",0,.1,.001),g.add(r,"mieDirectionalG",0,1,.001),g.close();const T=e.addFolder("Light");T.add(i,"intensity",0,5).name("Hemisphere Intensity"),T.addColor({skyColor:"#87ceeb"},"skyColor").onChange(M=>i.color.set(M)),T.addColor({groundColor:"#8b4513"},"groundColor").onChange(M=>i.groundColor.set(M)),T.add(n,"visible").name("Sun Helper"),T.add(a,"visible").name("Shadow Helper"),T.close();const A=e.addFolder("Location");A.add(t,"latitude").onChange(()=>s.updateLocation()),A.add(t,"longitude").onChange(()=>s.updateLocation()),A.add(t,"northOffset",0,360,1).onChange(()=>s.updateNorth()),A.close();const S=e.addFolder("Time");S.add(t,"minute",0,60,1).onChange(()=>s.updateHour()).listen(),S.add(t,"hour",0,24,1).onChange(()=>s.updateHour()).listen(),S.add(t,"day",1,30,1).onChange(()=>s.updateMonth()).listen(),S.add(t,"month",1,12,1).onChange(()=>s.updateMonth()).listen(),S.add(t,"animateTime"),S.add(t,"timeSpeed",0,1e4,.1),S.close();const D=e.addFolder("Sun Surface");D.add(t,"showSunSurface").onChange(()=>s.updateLocation()),D.add(t,"showAnalemmas").onChange(()=>s.updateLocation()),D.add(t,"showSunDayPath").onChange(()=>s.updateLocation()),D.add(s.sunPathLight.children[0].children[0],"visible").name("Sun Sphere"),s.sunPathLight.children[1].visible=!1,D.close();function P(){m.sunLight&&m.sceneLight?o("both"):m.sunLight?o("sun"):m.sceneLight?o("scene"):(o("scene"),m.sceneLight=!0)}function H(){const M=m.sunLight;g.domElement.style.display=M?"":"none",T.domElement.style.display=M?"":"none",A.domElement.style.display=M?"":"none",S.domElement.style.display=M?"":"none",D.domElement.style.display=M?"":"none"}return P(),H(),b.updateCameraControls(),e}class rn{constructor(e,t,i,n){this.camera=e,this.scene=t,this.renderer=i,this.stats=n,this.updatables=[],this.clock=new f.Clock,this.isActive=!1,this.timeoutId=null,this.animationCallback=null}start(){this.isActive=!0,this.animationCallback=()=>{this.isActive&&(this.tick(),this.renderer.render(this.scene,this.camera),this.stats&&this.stats.update())},this.renderer.setAnimationLoop(this.animationCallback)}stop(){this.isActive=!1,this.timeoutId&&clearTimeout(this.timeoutId),this.renderer.setAnimationLoop(null),this.animationCallback=null}resume(){this.isActive=!0,this.timeoutId&&clearTimeout(this.timeoutId),this.animationCallback||this.start()}pauseAfterDelay(e=1500){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>this.isActive=!1,e)}tick(){const e=this.clock.getDelta();for(const t of this.updatables)try{t.tick&&t.tick(e)}catch(i){console.error("Error in updatable:",t,i)}}updateRenderer(e){const t=this.isActive;this.stop(),this.renderer=e,t&&this.start()}setupInteractionListeners(){const e={ongoing:["mousemove","mousedown","wheel","touchstart","touchmove","keydown","resize"],ending:["touchend","touchcancel"]};this.onOngoingInteraction=()=>{this.resume(),this.pauseAfterDelay(2e3)},this.onInteractionEnd=()=>{this.pauseAfterDelay(2e3)},e.ongoing.forEach(t=>{window.addEventListener(t,this.onOngoingInteraction,{passive:!0})}),e.ending.forEach(t=>{window.addEventListener(t,this.onInteractionEnd,{passive:!0})}),this.destroyInteractionListeners=()=>{e.ongoing.forEach(t=>{window.removeEventListener(t,this.onOngoingInteraction)}),e.ending.forEach(t=>{window.removeEventListener(t,this.onInteractionEnd)}),this.stop()}}}class ln{constructor(e,t){this.container=e,this.camera=t,this.isMobile=/Android|iPhone|iPad/i.test(navigator.userAgent),this.isLandscape=window.innerWidth>window.innerHeight,this.platform=this.getPlatform(),this.mode="veloce",this.settings=this.getSettings(),this.renderer=this.createRenderer(),this.container.appendChild(this.renderer.domElement),this.bindEvents(),this.setSize()}getPlatform(){return this.isMobile?this.isLandscape?"mobileLandscape":"mobilePortrait":"desktop"}getSettings(){return{desktop:{veloce:{scale:1,pixelRatio:1,antialias:!1,shadows:!1,shadowMapWidth:512,shadowMapHeight:512},bellezza:{scale:1,pixelRatio:2,antialias:!0,shadows:!0,shadowMapWidth:2048,shadowMapHeight:2048}},mobileLandscape:{veloce:{scale:1,pixelRatio:1,antialias:!1,shadows:!1,shadowMapWidth:512,shadowMapHeight:512},bellezza:{scale:1,pixelRatio:2,antialias:!0,shadows:!0,shadowMapWidth:1024,shadowMapHeight:1024}},mobilePortrait:{veloce:{scale:1,pixelRatio:.5,antialias:!1,shadows:!1,shadowMapWidth:512,shadowMapHeight:512},bellezza:{scale:1,pixelRatio:1,antialias:!0,shadows:!0,shadowMapWidth:1024,shadowMapHeight:1024}}}[this.platform][this.mode]}createRenderer(){const e=this.settings,t=new Zt({antialias:e.antialias});return t.physicallyCorrectLights=!0,t.shadowMap.enabled=e.shadows,t.shadowMap.type=qt,t.toneMapping=f.CineonToneMapping,t.outputColorSpace=f.SRGBColorSpace,t.setClearColor(0),this.world&&(t.toneMappingExposure=this.world.params.exposure),t}setMode(e){this.mode=e;const t=this.settings;this.settings=this.getSettings(),t.antialias!==this.settings.antialias&&(this.renderer.dispose(),this.container.removeChild(this.renderer.domElement),this.renderer=this.createRenderer(),this.container.appendChild(this.renderer.domElement)),this.applySettings(),this.world&&this.world.scene&&this.world.camera&&this.renderer.render(this.world.scene,this.world.camera)}setSize(){this.isLandscape=window.innerWidth>window.innerHeight,this.platform=this.getPlatform(),this.settings=this.getSettings(),this.applySettings(),this.world&&this.world.scene&&this.world.camera&&this.renderer.render(this.world.scene,this.world.camera)}applySettings(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix();const e=window.innerWidth,t=window.innerHeight,i=e*this.settings.scale,n=t*this.settings.scale;this.renderer.setSize(i,n,!1);const a=this.renderer.domElement;a.style.width=`${i}px`,a.style.height=`${n}px`,a.style.position="absolute",a.style.left=`${(e-i)/2}px`,a.style.top=`${(t-n)/2}px`,this.renderer.setViewport(0,0,i,n),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,this.settings.pixelRatio))}bindEvents(){window.addEventListener("resize",()=>requestAnimationFrame(()=>this.setSize())),window.addEventListener("orientationchange",()=>requestAnimationFrame(()=>this.setSize()))}destroy(){window.removeEventListener("resize",this.onResize),window.removeEventListener("orientationchange",this.onOrientationChange),this.renderer.dispose(),this.container.removeChild(this.renderer.domElement)}setExposure(e,t,i,n){this.renderer.toneMappingExposure=e,i&&(i.intensity=.5*e),t&&t.traverse(a=>{var s,r,o;if(a.isLight&&a!==((o=(r=(s=this.world)==null?void 0:s.lightingManager)==null?void 0:r.sunPath)==null?void 0:o.sunLight)&&a!==i){const l=a.userData.baseIntensity||a.intensity;a.userData.baseIntensity=l,a.intensity=l*e}}),n&&n.setExposure(e)}setToneMapping(e){switch(e){case"NoToneMapping":this.renderer.toneMapping=f.NoToneMapping;break;case"LinearToneMapping":this.renderer.toneMapping=f.LinearToneMapping;break;case"ReinhardToneMapping":this.renderer.toneMapping=f.ReinhardToneMapping;break;case"CineonToneMapping":this.renderer.toneMapping=f.CineonToneMapping;break;case"ACESFilmicToneMapping":this.renderer.toneMapping=f.ACESFilmicToneMapping;break;case"AgXToneMapping":this.renderer.toneMapping=f.AgXToneMapping;break;case"NeutralToneMapping":this.renderer.toneMapping=f.NeutralToneMapping;break;case"CustomToneMapping":this.renderer.toneMapping=f.CustomToneMapping;break;default:console.warn("Invalid tone mapping:",e),this.renderer.toneMapping=f.ReinhardToneMapping}this.renderer.render(this.world.scene,this.world.camera)}updateShadows(){const e=this.settings;if(this.world.lightingManager.sunPath&&this.world.lightingManager.sunPath.sunLight){const t=this.world.lightingManager.sunPath.sunLight;t.castShadow=e.shadows,t.shadow.mapSize.width=e.shadowMapWidth,t.shadow.mapSize.height=e.shadowMapHeight,t.shadow.bias=-1e-4,t.shadow.normalBias=.01,t.shadow.map&&(t.shadow.map.dispose(),t.shadow.map=null)}this.world.sceneManager.currentScene&&this.world.sceneManager.currentScene.traverse(t=>{var i,n;(t.isDirectionalLight||t.isSpotLight)&&t!==((n=(i=this.world.lightingManager)==null?void 0:i.sunPath)==null?void 0:n.sunLight)&&(t.castShadow=e.shadows,t.shadow.mapSize.width=e.shadowMapWidth,t.shadow.mapSize.height=e.shadowMapHeight,t.shadow.bias=-1e-4,t.shadow.normalBias=.01,t.shadow.map&&(t.shadow.map.dispose(),t.shadow.map=null))})}preRenderShadows(){var i,n;if(this.mode!=="veloce")return;const t=this.getSettings().desktop.bellezza;if(!t){console.warn("Cannot pre-render shadows: bellezza settings are undefined");return}this.renderer.shadowMap.enabled=!0,(n=(i=this.world.lightingManager)==null?void 0:i.sunPath)!=null&&n.sunLight&&(this.world.lightingManager.sunPath.sunLight.shadow.mapSize.width=t.shadowMapWidth,this.world.lightingManager.sunPath.sunLight.shadow.mapSize.height=t.shadowMapHeight,this.world.lightingManager.sunPath.sunLight.castShadow=!0),this.renderer.render(this.world.scene,this.world.camera)}}function ut(c,e){if(e===Jt)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),c;if(e===Ue||e===Ct){let t=c.getIndex();if(t===null){const s=[],r=c.getAttribute("position");if(r!==void 0){for(let o=0;o<r.count;o++)s.push(o);c.setIndex(s),t=c.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),c}const i=t.count-2,n=[];if(e===Ue)for(let s=1;s<=i;s++)n.push(t.getX(0)),n.push(t.getX(s)),n.push(t.getX(s+1));else for(let s=0;s<i;s++)s%2===0?(n.push(t.getX(s)),n.push(t.getX(s+1)),n.push(t.getX(s+2))):(n.push(t.getX(s+2)),n.push(t.getX(s+1)),n.push(t.getX(s)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=c.clone();return a.setIndex(n),a.clearGroups(),a}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),c}class Ot extends xt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new mn(t)}),this.register(function(t){return new pn(t)}),this.register(function(t){return new En(t)}),this.register(function(t){return new Cn(t)}),this.register(function(t){return new xn(t)}),this.register(function(t){return new gn(t)}),this.register(function(t){return new bn(t)}),this.register(function(t){return new yn(t)}),this.register(function(t){return new _n(t)}),this.register(function(t){return new un(t)}),this.register(function(t){return new wn(t)}),this.register(function(t){return new fn(t)}),this.register(function(t){return new An(t)}),this.register(function(t){return new Tn(t)}),this.register(function(t){return new hn(t)}),this.register(function(t){return new Mn(t)}),this.register(function(t){return new Sn(t)})}load(e,t,i,n){const a=this;let s;if(this.resourcePath!=="")s=this.resourcePath;else if(this.path!==""){const l=we.extractUrlBase(e);s=we.resolveURL(l,this.path)}else s=we.extractUrlBase(e);this.manager.itemStart(e);const r=function(l){n?n(l):console.error(l),a.manager.itemError(e),a.manager.itemEnd(e)},o=new Re(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{a.parse(l,s,function(h){t(h),a.manager.itemEnd(e)},r)}catch(h){r(h)}},i,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let a;const s={},r={},o=new TextDecoder;if(typeof e=="string")a=JSON.parse(e);else if(e instanceof ArrayBuffer)if(o.decode(new Uint8Array(e,0,4))===It){try{s[x.KHR_BINARY_GLTF]=new vn(e)}catch(d){n&&n(d);return}a=JSON.parse(s[x.KHR_BINARY_GLTF].content)}else a=JSON.parse(o.decode(e));else a=e;if(a.asset===void 0||a.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Gn(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](l);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[d.name]=d,s[d.name]=!0}if(a.extensionsUsed)for(let h=0;h<a.extensionsUsed.length;++h){const d=a.extensionsUsed[h],u=a.extensionsRequired||[];switch(d){case x.KHR_MATERIALS_UNLIT:s[d]=new dn;break;case x.KHR_DRACO_MESH_COMPRESSION:s[d]=new Rn(a,this.dracoLoader);break;case x.KHR_TEXTURE_TRANSFORM:s[d]=new Ln;break;case x.KHR_MESH_QUANTIZATION:s[d]=new kn;break;default:u.indexOf(d)>=0&&r[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}l.setExtensions(s),l.setPlugins(r),l.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,a){i.parse(e,t,n,a)})}}function cn(){let c={};return{get:function(e){return c[e]},add:function(e,t){c[e]=t},remove:function(e){delete c[e]},removeAll:function(){c={}}}}const x={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class hn{constructor(e){this.parser=e,this.name=x.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const a=t[i];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const a=t.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let l;const h=new ae(16777215);o.color!==void 0&&h.setRGB(o.color[0],o.color[1],o.color[2],q);const d=o.range!==void 0?o.range:0;switch(o.type){case"directional":l=new Mt(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new ei(h),l.distance=d;break;case"spot":l=new Qt(h),l.distance=d,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,l.angle=o.spot.outerConeAngle,l.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return l.position.set(0,0,0),ie(l,o),o.intensity!==void 0&&(l.intensity=o.intensity),l.name=t.createUniqueName(o.name||"light_"+e),n=Promise.resolve(l),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,a=i.json.nodes[e],r=(a.extensions&&a.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(o){return i._getNodeRef(t.cache,r,o)})}}class dn{constructor(){this.name=x.KHR_MATERIALS_UNLIT}getMaterialType(){return le}extendParams(e,t,i){const n=[];e.color=new ae(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const s=a.baseColorFactor;e.color.setRGB(s[0],s[1],s[2],q),e.opacity=s[3]}a.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",a.baseColorTexture,se))}return Promise.all(n)}}class un{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=n.extensions[this.name].emissiveStrength;return a!==void 0&&(t.emissiveIntensity=a),Promise.resolve()}}class mn{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:J}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],s=n.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&a.push(i.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&a.push(i.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(a.push(i.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){const r=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new j(r,r)}return Promise.all(a)}}class pn{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:J}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=n.extensions[this.name];return t.dispersion=a.dispersion!==void 0?a.dispersion:0,Promise.resolve()}}class fn{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:J}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],s=n.extensions[this.name];return s.iridescenceFactor!==void 0&&(t.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&a.push(i.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(t.iridescenceIOR=s.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&a.push(i.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(a)}}class gn{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:J}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new ae(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=n.extensions[this.name];if(s.sheenColorFactor!==void 0){const r=s.sheenColorFactor;t.sheenColor.setRGB(r[0],r[1],r[2],q)}return s.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&a.push(i.assignTexture(t,"sheenColorMap",s.sheenColorTexture,se)),s.sheenRoughnessTexture!==void 0&&a.push(i.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(a)}}class bn{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:J}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],s=n.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&a.push(i.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(a)}}class yn{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:J}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],s=n.extensions[this.name];t.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&a.push(i.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const r=s.attenuationColor||[1,1,1];return t.attenuationColor=new ae().setRGB(r[0],r[1],r[2],q),Promise.all(a)}}class _n{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:J}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=n.extensions[this.name];return t.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class wn{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:J}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],s=n.extensions[this.name];t.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&a.push(i.assignTexture(t,"specularIntensityMap",s.specularTexture));const r=s.specularColorFactor||[1,1,1];return t.specularColor=new ae().setRGB(r[0],r[1],r[2],q),s.specularColorTexture!==void 0&&a.push(i.assignTexture(t,"specularColorMap",s.specularColorTexture,se)),Promise.all(a)}}class Tn{constructor(e){this.parser=e,this.name=x.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:J}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],s=n.extensions[this.name];return t.bumpScale=s.bumpFactor!==void 0?s.bumpFactor:1,s.bumpTexture!==void 0&&a.push(i.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(a)}}class An{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:J}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],s=n.extensions[this.name];return s.anisotropyStrength!==void 0&&(t.anisotropy=s.anisotropyStrength),s.anisotropyRotation!==void 0&&(t.anisotropyRotation=s.anisotropyRotation),s.anisotropyTexture!==void 0&&a.push(i.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(a)}}class En{constructor(e){this.parser=e,this.name=x.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const a=n.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,s)}}class Cn{constructor(e){this.parser=e,this.name=x.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,a=n.textures[e];if(!a.extensions||!a.extensions[t])return null;const s=a.extensions[t],r=n.images[s.source];let o=i.textureLoader;if(r.uri){const l=i.options.manager.getHandler(r.uri);l!==null&&(o=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(e,s.source,o);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class xn{constructor(e){this.parser=e,this.name=x.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,a=n.textures[e];if(!a.extensions||!a.extensions[t])return null;const s=a.extensions[t],r=n.images[s.source];let o=i.textureLoader;if(r.uri){const l=i.options.manager.getHandler(r.uri);l!==null&&(o=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(e,s.source,o);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Mn{constructor(e){this.name=x.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],a=this.parser.getDependency("buffer",n.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(function(r){const o=n.byteOffset||0,l=n.byteLength||0,h=n.count,d=n.byteStride,u=new Uint8Array(r,o,l);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(h,d,u,n.mode,n.filter).then(function(m){return m.buffer}):s.ready.then(function(){const m=new ArrayBuffer(h*d);return s.decodeGltfBuffer(new Uint8Array(m),h,d,u,n.mode,n.filter),m})})}else return null}}class Sn{constructor(e){this.name=x.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const l of n.primitives)if(l.mode!==$.TRIANGLES&&l.mode!==$.TRIANGLE_STRIP&&l.mode!==$.TRIANGLE_FAN&&l.mode!==void 0)return null;const s=i.extensions[this.name].attributes,r=[],o={};for(const l in s)r.push(this.parser.getDependency("accessor",s[l]).then(h=>(o[l]=h,o[l])));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then(l=>{const h=l.pop(),d=h.isGroup?h.children:[h],u=l[0].count,m=[];for(const p of d){const _=new Le,b=new F,w=new ve,g=new F(1,1,1),T=new ti(p.geometry,p.material,u);for(let A=0;A<u;A++)o.TRANSLATION&&b.fromBufferAttribute(o.TRANSLATION,A),o.ROTATION&&w.fromBufferAttribute(o.ROTATION,A),o.SCALE&&g.fromBufferAttribute(o.SCALE,A),T.setMatrixAt(A,_.compose(b,w,g));for(const A in o)if(A==="_COLOR_0"){const S=o[A];T.instanceColor=new ii(S.array,S.itemSize,S.normalized)}else A!=="TRANSLATION"&&A!=="ROTATION"&&A!=="SCALE"&&p.geometry.setAttribute(A,o[A]);St.prototype.copy.call(T,p),this.parser.assignFinalMaterial(T),m.push(T)}return h.isGroup?(h.clear(),h.add(...m),h):m[0]}))}}const It="glTF",ye=12,mt={JSON:1313821514,BIN:5130562};class vn{constructor(e){this.name=x.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,ye),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==It)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-ye,a=new DataView(e,ye);let s=0;for(;s<n;){const r=a.getUint32(s,!0);s+=4;const o=a.getUint32(s,!0);if(s+=4,o===mt.JSON){const l=new Uint8Array(e,ye+s,r);this.content=i.decode(l)}else if(o===mt.BIN){const l=ye+s;this.body=e.slice(l,l+r)}s+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Rn{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=x.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,a=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,r={},o={},l={};for(const h in s){const d=Ye[h]||h.toLowerCase();r[d]=s[h]}for(const h in e.attributes){const d=Ye[h]||h.toLowerCase();if(s[h]!==void 0){const u=i.accessors[e.attributes[h]],m=ge[u.componentType];l[d]=m.name,o[d]=u.normalized===!0}}return t.getDependency("bufferView",a).then(function(h){return new Promise(function(d,u){n.decodeDracoFile(h,function(m){for(const p in m.attributes){const _=m.attributes[p],b=o[p];b!==void 0&&(_.normalized=b)}d(m)},r,l,q,u)})})}}class Ln{constructor(){this.name=x.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class kn{constructor(){this.name=x.KHR_MESH_QUANTIZATION}}class Nt extends xi{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,a=e*n*3+n;for(let s=0;s!==n;s++)t[s]=i[a+s];return t}interpolate_(e,t,i,n){const a=this.resultBuffer,s=this.sampleValues,r=this.valueSize,o=r*2,l=r*3,h=n-t,d=(i-t)/h,u=d*d,m=u*d,p=e*l,_=p-l,b=-2*m+3*u,w=m-u,g=1-b,T=w-u+d;for(let A=0;A!==r;A++){const S=s[_+A+r],D=s[_+A+o]*h,P=s[p+A+r],H=s[p+A]*h;a[A]=g*S+T*D+b*P+w*H}return a}}const Pn=new ve;class Fn extends Nt{interpolate_(e,t,i,n){const a=super.interpolate_(e,t,i,n);return Pn.fromArray(a).normalize().toArray(a),a}}const $={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ge={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},pt={9728:Rt,9729:$e,9984:ci,9985:li,9986:ri,9987:vt},ft={33071:di,33648:hi,10497:Ve},He={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ye={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ne={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Dn={CUBICSPLINE:void 0,LINEAR:Ft,STEP:Ei},Be={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function On(c){return c.DefaultMaterial===void 0&&(c.DefaultMaterial=new kt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ci})),c.DefaultMaterial}function re(c,e,t){for(const i in t.extensions)c[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function ie(c,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(c.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function In(c,e,t){let i=!1,n=!1,a=!1;for(let l=0,h=e.length;l<h;l++){const d=e[l];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(n=!0),d.COLOR_0!==void 0&&(a=!0),i&&n&&a)break}if(!i&&!n&&!a)return Promise.resolve(c);const s=[],r=[],o=[];for(let l=0,h=e.length;l<h;l++){const d=e[l];if(i){const u=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):c.attributes.position;s.push(u)}if(n){const u=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):c.attributes.normal;r.push(u)}if(a){const u=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):c.attributes.color;o.push(u)}}return Promise.all([Promise.all(s),Promise.all(r),Promise.all(o)]).then(function(l){const h=l[0],d=l[1],u=l[2];return i&&(c.morphAttributes.position=h),n&&(c.morphAttributes.normal=d),a&&(c.morphAttributes.color=u),c.morphTargetsRelative=!0,c})}function Nn(c,e){if(c.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)c.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(c.morphTargetInfluences.length===t.length){c.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)c.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Hn(c){let e;const t=c.extensions&&c.extensions[x.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+ze(t.attributes):e=c.indices+":"+ze(c.attributes)+":"+c.mode,c.targets!==void 0)for(let i=0,n=c.targets.length;i<n;i++)e+=":"+ze(c.targets[i]);return e}function ze(c){let e="";const t=Object.keys(c).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+c[t[i]]+";";return e}function Ze(c){switch(c){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Bn(c){return c.search(/\.jpe?g($|\?)/i)>0||c.search(/^data\:image\/jpeg/)===0?"image/jpeg":c.search(/\.webp($|\?)/i)>0||c.search(/^data\:image\/webp/)===0?"image/webp":c.search(/\.ktx2($|\?)/i)>0||c.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const zn=new Le;class Gn{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new cn,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=-1,a=!1,s=-1;if(typeof navigator<"u"){const r=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(r)===!0;const o=r.match(/Version\/(\d+)/);n=i&&o?parseInt(o[1],10):-1,a=r.indexOf("Firefox")>-1,s=a?r.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&n<17||a&&s<98?this.textureLoader=new ni(this.options.manager):this.textureLoader=new si(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Re(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(s){const r={scene:s[0][n.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:n.asset,parser:i,userData:{}};return re(a,r,n),ie(r,n),Promise.all(i._invokeAll(function(o){return o.afterRoot&&o.afterRoot(r)})).then(function(){for(const o of r.scenes)o.updateMatrixWorld();e(r)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,a=t.length;n<a;n++){const s=t[n].joints;for(let r=0,o=s.length;r<o;r++)e[s[r]].isBone=!0}for(let n=0,a=e.length;n<a;n++){const s=e[n];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(i[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),a=(s,r)=>{const o=this.associations.get(s);o!=null&&this.associations.set(r,o);for(const[l,h]of s.children.entries())a(h,r.children[l])};return a(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const a=e(t[n]);a&&i.push(a)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(a){return a.loadNode&&a.loadNode(t)});break;case"mesh":n=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(a){return a.loadAnimation&&a.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(a,s){return i.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[x.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(a,s){i.load(we.resolveURL(t.uri,n.path),a,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,a=t.byteOffset||0;return i.slice(a,a+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const s=He[n.type],r=ge[n.componentType],o=n.normalized===!0,l=new r(n.count*s);return Promise.resolve(new Te(l,s,o))}const a=[];return n.bufferView!==void 0?a.push(this.getDependency("bufferView",n.bufferView)):a.push(null),n.sparse!==void 0&&(a.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(a).then(function(s){const r=s[0],o=He[n.type],l=ge[n.componentType],h=l.BYTES_PER_ELEMENT,d=h*o,u=n.byteOffset||0,m=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,p=n.normalized===!0;let _,b;if(m&&m!==d){const w=Math.floor(u/m),g="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+w+":"+n.count;let T=t.cache.get(g);T||(_=new l(r,w*m,n.count*m/h),T=new ai(_,m/h),t.cache.add(g,T)),b=new oi(T,o,u%m/h,p)}else r===null?_=new l(n.count*o):_=new l(r,u,n.count*o),b=new Te(_,o,p);if(n.sparse!==void 0){const w=He.SCALAR,g=ge[n.sparse.indices.componentType],T=n.sparse.indices.byteOffset||0,A=n.sparse.values.byteOffset||0,S=new g(s[1],T,n.sparse.count*w),D=new l(s[2],A,n.sparse.count*o);r!==null&&(b=new Te(b.array.slice(),b.itemSize,b.normalized)),b.normalized=!1;for(let P=0,H=S.length;P<H;P++){const M=S[P];if(b.setX(M,D[P*o]),o>=2&&b.setY(M,D[P*o+1]),o>=3&&b.setZ(M,D[P*o+2]),o>=4&&b.setW(M,D[P*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}b.normalized=p}return b})}loadTexture(e){const t=this.json,i=this.options,a=t.textures[e].source,s=t.images[a];let r=this.textureLoader;if(s.uri){const o=i.manager.getHandler(s.uri);o!==null&&(r=o)}return this.loadTextureImage(e,a,r)}loadTextureImage(e,t,i){const n=this,a=this.json,s=a.textures[e],r=a.images[t],o=(r.uri||r.bufferView)+":"+s.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(t,i).then(function(h){h.flipY=!1,h.name=s.name||r.name||"",h.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(h.name=r.uri);const u=(a.samplers||{})[s.sampler]||{};return h.magFilter=pt[u.magFilter]||$e,h.minFilter=pt[u.minFilter]||vt,h.wrapS=ft[u.wrapS]||Ve,h.wrapT=ft[u.wrapT]||Ve,h.generateMipmaps=!h.isCompressedTexture&&h.minFilter!==Rt&&h.minFilter!==$e,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[o]=l,l}loadImageSource(e,t){const i=this,n=this.json,a=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const s=n.images[e],r=self.URL||self.webkitURL;let o=s.uri||"",l=!1;if(s.bufferView!==void 0)o=i.getDependency("bufferView",s.bufferView).then(function(d){l=!0;const u=new Blob([d],{type:s.mimeType});return o=r.createObjectURL(u),o});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(o).then(function(d){return new Promise(function(u,m){let p=u;t.isImageBitmapLoader===!0&&(p=function(_){const b=new st(_);b.needsUpdate=!0,u(b)}),t.load(we.resolveURL(d,a.path),p,void 0,m)})}).then(function(d){return l===!0&&r.revokeObjectURL(o),ie(d,s),d.userData.mimeType=s.mimeType||Bn(s.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),d});return this.sourceCache[e]=h,h}assignTexture(e,t,i,n){const a=this;return this.getDependency("texture",i.index).then(function(s){if(!s)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(s=s.clone(),s.channel=i.texCoord),a.extensions[x.KHR_TEXTURE_TRANSFORM]){const r=i.extensions!==void 0?i.extensions[x.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const o=a.associations.get(s);s=a.extensions[x.KHR_TEXTURE_TRANSFORM].extendTexture(s,r),a.associations.set(s,o)}}return n!==void 0&&(s.colorSpace=n),e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,a=t.attributes.color!==void 0,s=t.attributes.normal===void 0;if(e.isPoints){const r="PointsMaterial:"+i.uuid;let o=this.cache.get(r);o||(o=new ui,De.prototype.copy.call(o,i),o.color.copy(i.color),o.map=i.map,o.sizeAttenuation=!1,this.cache.add(r,o)),i=o}else if(e.isLine){const r="LineBasicMaterial:"+i.uuid;let o=this.cache.get(r);o||(o=new Lt,De.prototype.copy.call(o,i),o.color.copy(i.color),o.map=i.map,this.cache.add(r,o)),i=o}if(n||a||s){let r="ClonedMaterial:"+i.uuid+":";n&&(r+="derivative-tangents:"),a&&(r+="vertex-colors:"),s&&(r+="flat-shading:");let o=this.cache.get(r);o||(o=i.clone(),a&&(o.vertexColors=!0),s&&(o.flatShading=!0),n&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(r,o),this.associations.set(o,this.associations.get(i))),i=o}e.material=i}getMaterialType(){return kt}loadMaterial(e){const t=this,i=this.json,n=this.extensions,a=i.materials[e];let s;const r={},o=a.extensions||{},l=[];if(o[x.KHR_MATERIALS_UNLIT]){const d=n[x.KHR_MATERIALS_UNLIT];s=d.getMaterialType(),l.push(d.extendParams(r,a,t))}else{const d=a.pbrMetallicRoughness||{};if(r.color=new ae(1,1,1),r.opacity=1,Array.isArray(d.baseColorFactor)){const u=d.baseColorFactor;r.color.setRGB(u[0],u[1],u[2],q),r.opacity=u[3]}d.baseColorTexture!==void 0&&l.push(t.assignTexture(r,"map",d.baseColorTexture,se)),r.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,r.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(r,"metalnessMap",d.metallicRoughnessTexture)),l.push(t.assignTexture(r,"roughnessMap",d.metallicRoughnessTexture))),s=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(e,r)})))}a.doubleSided===!0&&(r.side=Pt);const h=a.alphaMode||Be.OPAQUE;if(h===Be.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,h===Be.MASK&&(r.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&s!==le&&(l.push(t.assignTexture(r,"normalMap",a.normalTexture)),r.normalScale=new j(1,1),a.normalTexture.scale!==void 0)){const d=a.normalTexture.scale;r.normalScale.set(d,d)}if(a.occlusionTexture!==void 0&&s!==le&&(l.push(t.assignTexture(r,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&s!==le){const d=a.emissiveFactor;r.emissive=new ae().setRGB(d[0],d[1],d[2],q)}return a.emissiveTexture!==void 0&&s!==le&&l.push(t.assignTexture(r,"emissiveMap",a.emissiveTexture,se)),Promise.all(l).then(function(){const d=new s(r);return a.name&&(d.name=a.name),ie(d,a),t.associations.set(d,{materials:e}),a.extensions&&re(n,d,a),d})}createUniqueName(e){const t=mi.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function a(r){return i[x.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,t).then(function(o){return gt(o,r,t)})}const s=[];for(let r=0,o=e.length;r<o;r++){const l=e[r],h=Hn(l),d=n[h];if(d)s.push(d.promise);else{let u;l.extensions&&l.extensions[x.KHR_DRACO_MESH_COMPRESSION]?u=a(l):u=gt(new Ae,l,t),n[h]={primitive:l,promise:u},s.push(u)}}return Promise.all(s)}loadMesh(e){const t=this,i=this.json,n=this.extensions,a=i.meshes[e],s=a.primitives,r=[];for(let o=0,l=s.length;o<l;o++){const h=s[o].material===void 0?On(this.cache):this.getDependency("material",s[o].material);r.push(h)}return r.push(t.loadGeometries(s)),Promise.all(r).then(function(o){const l=o.slice(0,o.length-1),h=o[o.length-1],d=[];for(let m=0,p=h.length;m<p;m++){const _=h[m],b=s[m];let w;const g=l[m];if(b.mode===$.TRIANGLES||b.mode===$.TRIANGLE_STRIP||b.mode===$.TRIANGLE_FAN||b.mode===void 0)w=a.isSkinnedMesh===!0?new pi(_,g):new ke(_,g),w.isSkinnedMesh===!0&&w.normalizeSkinWeights(),b.mode===$.TRIANGLE_STRIP?w.geometry=ut(w.geometry,Ct):b.mode===$.TRIANGLE_FAN&&(w.geometry=ut(w.geometry,Ue));else if(b.mode===$.LINES)w=new fi(_,g);else if(b.mode===$.LINE_STRIP)w=new gi(_,g);else if(b.mode===$.LINE_LOOP)w=new Ke(_,g);else if(b.mode===$.POINTS)w=new bi(_,g);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(w.geometry.morphAttributes).length>0&&Nn(w,a),w.name=t.createUniqueName(a.name||"mesh_"+e),ie(w,a),b.extensions&&re(n,w,b),t.assignFinalMaterial(w),d.push(w)}for(let m=0,p=d.length;m<p;m++)t.associations.set(d[m],{meshes:e,primitives:m});if(d.length===1)return a.extensions&&re(n,d[0],a),d[0];const u=new ce;a.extensions&&re(n,u,a),t.associations.set(u,{meshes:e});for(let m=0,p=d.length;m<p;m++)u.add(d[m]);return u})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new yi(qe.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new _i(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),ie(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,a=t.joints.length;n<a;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const a=n.pop(),s=n,r=[],o=[];for(let l=0,h=s.length;l<h;l++){const d=s[l];if(d){r.push(d);const u=new Le;a!==null&&u.fromArray(a.array,l*16),o.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new wi(r,o)})}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],a=n.name?n.name:"animation_"+e,s=[],r=[],o=[],l=[],h=[];for(let d=0,u=n.channels.length;d<u;d++){const m=n.channels[d],p=n.samplers[m.sampler],_=m.target,b=_.node,w=n.parameters!==void 0?n.parameters[p.input]:p.input,g=n.parameters!==void 0?n.parameters[p.output]:p.output;_.node!==void 0&&(s.push(this.getDependency("node",b)),r.push(this.getDependency("accessor",w)),o.push(this.getDependency("accessor",g)),l.push(p),h.push(_))}return Promise.all([Promise.all(s),Promise.all(r),Promise.all(o),Promise.all(l),Promise.all(h)]).then(function(d){const u=d[0],m=d[1],p=d[2],_=d[3],b=d[4],w=[];for(let g=0,T=u.length;g<T;g++){const A=u[g],S=m[g],D=p[g],P=_[g],H=b[g];if(A===void 0)continue;A.updateMatrix&&A.updateMatrix();const M=i._createAnimationTracks(A,S,D,P,H);if(M)for(let B=0;B<M.length;B++)w.push(M[B])}return new Ti(a,void 0,w)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(a){const s=i._getNodeRef(i.meshCache,n.mesh,a);return n.weights!==void 0&&s.traverse(function(r){if(r.isMesh)for(let o=0,l=n.weights.length;o<l;o++)r.morphTargetInfluences[o]=n.weights[o]}),s})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],a=i._loadNodeShallow(e),s=[],r=n.children||[];for(let l=0,h=r.length;l<h;l++)s.push(i.getDependency("node",r[l]));const o=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([a,Promise.all(s),o]).then(function(l){const h=l[0],d=l[1],u=l[2];u!==null&&h.traverse(function(m){m.isSkinnedMesh&&m.bind(u,zn)});for(let m=0,p=d.length;m<p;m++)h.add(d[m]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const a=t.nodes[e],s=a.name?n.createUniqueName(a.name):"",r=[],o=n._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return o&&r.push(o),a.camera!==void 0&&r.push(n.getDependency("camera",a.camera).then(function(l){return n._getNodeRef(n.cameraCache,a.camera,l)})),n._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){r.push(l)}),this.nodeCache[e]=Promise.all(r).then(function(l){let h;if(a.isBone===!0?h=new Ai:l.length>1?h=new ce:l.length===1?h=l[0]:h=new St,h!==l[0])for(let d=0,u=l.length;d<u;d++)h.add(l[d]);if(a.name&&(h.userData.name=a.name,h.name=s),ie(h,a),a.extensions&&re(i,h,a),a.matrix!==void 0){const d=new Le;d.fromArray(a.matrix),h.applyMatrix4(d)}else a.translation!==void 0&&h.position.fromArray(a.translation),a.rotation!==void 0&&h.quaternion.fromArray(a.rotation),a.scale!==void 0&&h.scale.fromArray(a.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,a=new ce;i.name&&(a.name=n.createUniqueName(i.name)),ie(a,i),i.extensions&&re(t,a,i);const s=i.nodes||[],r=[];for(let o=0,l=s.length;o<l;o++)r.push(n.getDependency("node",s[o]));return Promise.all(r).then(function(o){for(let h=0,d=o.length;h<d;h++)a.add(o[h]);const l=h=>{const d=new Map;for(const[u,m]of n.associations)(u instanceof De||u instanceof st)&&d.set(u,m);return h.traverse(u=>{const m=n.associations.get(u);m!=null&&d.set(u,m)}),d};return n.associations=l(a),a})}_createAnimationTracks(e,t,i,n,a){const s=[],r=e.name?e.name:e.uuid,o=[];ne[a.path]===ne.weights?e.traverse(function(u){u.morphTargetInfluences&&o.push(u.name?u.name:u.uuid)}):o.push(r);let l;switch(ne[a.path]){case ne.weights:l=ot;break;case ne.rotation:l=rt;break;case ne.position:case ne.scale:l=at;break;default:switch(i.itemSize){case 1:l=ot;break;case 2:case 3:default:l=at;break}break}const h=n.interpolation!==void 0?Dn[n.interpolation]:Ft,d=this._getArrayFromAccessor(i);for(let u=0,m=o.length;u<m;u++){const p=new l(o[u]+"."+ne[a.path],t.array,d,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),s.push(p)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=Ze(t.constructor),n=new Float32Array(t.length);for(let a=0,s=t.length;a<s;a++)n[a]=t[a]*i;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const n=this instanceof rt?Fn:Nt;return new n(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function jn(c,e,t){const i=e.attributes,n=new Mi;if(i.POSITION!==void 0){const r=t.json.accessors[i.POSITION],o=r.min,l=r.max;if(o!==void 0&&l!==void 0){if(n.set(new F(o[0],o[1],o[2]),new F(l[0],l[1],l[2])),r.normalized){const h=Ze(ge[r.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const a=e.targets;if(a!==void 0){const r=new F,o=new F;for(let l=0,h=a.length;l<h;l++){const d=a[l];if(d.POSITION!==void 0){const u=t.json.accessors[d.POSITION],m=u.min,p=u.max;if(m!==void 0&&p!==void 0){if(o.setX(Math.max(Math.abs(m[0]),Math.abs(p[0]))),o.setY(Math.max(Math.abs(m[1]),Math.abs(p[1]))),o.setZ(Math.max(Math.abs(m[2]),Math.abs(p[2]))),u.normalized){const _=Ze(ge[u.componentType]);o.multiplyScalar(_)}r.max(o)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(r)}c.boundingBox=n;const s=new Si;n.getCenter(s.center),s.radius=n.min.distanceTo(n.max)/2,c.boundingSphere=s}function gt(c,e,t){const i=e.attributes,n=[];function a(s,r){return t.getDependency("accessor",s).then(function(o){c.setAttribute(r,o)})}for(const s in i){const r=Ye[s]||s.toLowerCase();r in c.attributes||n.push(a(i[s],r))}if(e.indices!==void 0&&!c.index){const s=t.getDependency("accessor",e.indices).then(function(r){c.setIndex(r)});n.push(s)}return We.workingColorSpace!==q&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${We.workingColorSpace}" not supported.`),ie(c,e),jn(c,e,t),Promise.all(n).then(function(){return e.targets!==void 0?In(c,e.targets,t):c})}const Ge=new WeakMap;class Ht extends xt{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){const a=new Re(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,s=>{this.parse(s,t,n)},i,n)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,se,i).catch(i)}decodeDracoFile(e,t,i,n,a=q,s=()=>{}){const r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:a};return this.decodeGeometry(e,r).then(t).catch(s)}decodeGeometry(e,t){const i=JSON.stringify(t);if(Ge.has(e)){const o=Ge.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const a=this.workerNextTaskID++,s=e.byteLength,r=this._getWorker(a,s).then(o=>(n=o,new Promise((l,h)=>{n._callbacks[a]={resolve:l,reject:h},n.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return r.catch(()=>!0).then(()=>{n&&a&&this._releaseTask(n,a)}),Ge.set(e,{key:i,promise:r}),r}_createGeometry(e){const t=new Ae;e.index&&t.setIndex(new Te(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i],a=n.name,s=n.array,r=n.itemSize,o=new Te(s,r);a==="color"&&(this._assignVertexColorSpace(o,n.vertexColorSpace),o.normalized=!(s instanceof Float32Array)),t.setAttribute(a,o)}return t}_assignVertexColorSpace(e,t){if(t!==se)return;const i=new ae;for(let n=0,a=e.count;n<a;n++)i.fromBufferAttribute(e,n),We.toWorkingColorSpace(i,se),e.setXYZ(n,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new Re(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((n,a)=>{i.load(e,n,void 0,a)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const n=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const a=Un.toString(),s=["/* draco decoder */",n,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(a){const s=a.data;switch(s.type){case"decode":n._callbacks[s.id].resolve(s);break;case"error":n._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,a){return n._taskLoad>a._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Un(){let c,e;onmessage=function(s){const r=s.data;switch(r.type){case"init":c=r.decoderConfig,e=new Promise(function(h){c.onModuleLoaded=function(d){h({draco:d})},DracoDecoderModule(c)});break;case"decode":const o=r.buffer,l=r.taskConfig;e.then(h=>{const d=h.draco,u=new d.Decoder;try{const m=t(d,u,new Int8Array(o),l),p=m.attributes.map(_=>_.array.buffer);m.index&&p.push(m.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:m},p)}catch(m){console.error(m),self.postMessage({type:"error",id:r.id,error:m.message})}finally{d.destroy(u)}});break}};function t(s,r,o,l){const h=l.attributeIDs,d=l.attributeTypes;let u,m;const p=r.GetEncodedGeometryType(o);if(p===s.TRIANGULAR_MESH)u=new s.Mesh,m=r.DecodeArrayToMesh(o,o.byteLength,u);else if(p===s.POINT_CLOUD)u=new s.PointCloud,m=r.DecodeArrayToPointCloud(o,o.byteLength,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!m.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+m.error_msg());const _={index:null,attributes:[]};for(const b in h){const w=self[d[b]];let g,T;if(l.useUniqueIDs)T=h[b],g=r.GetAttributeByUniqueId(u,T);else{if(T=r.GetAttributeId(u,s[h[b]]),T===-1)continue;g=r.GetAttribute(u,T)}const A=n(s,r,u,b,w,g);b==="color"&&(A.vertexColorSpace=l.vertexColorSpace),_.attributes.push(A)}return p===s.TRIANGULAR_MESH&&(_.index=i(s,r,u)),s.destroy(u),_}function i(s,r,o){const h=o.num_faces()*3,d=h*4,u=s._malloc(d);r.GetTrianglesUInt32Array(o,d,u);const m=new Uint32Array(s.HEAPF32.buffer,u,h).slice();return s._free(u),{array:m,itemSize:1}}function n(s,r,o,l,h,d){const u=d.num_components(),p=o.num_points()*u,_=p*h.BYTES_PER_ELEMENT,b=a(s,h),w=s._malloc(_);r.GetAttributeDataArrayForAllPoints(o,d,b,_,w);const g=new h(s.HEAPF32.buffer,w,p).slice();return s._free(w),{name:l,array:g,itemSize:u}}function a(s,r){switch(r){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32}}}const Bt={glass_clear:{type:"glass",albedo:[.034230206565082,.0986891975410945,.034230206565082],metallic:.3,roughness:0,opacity:.3,thickness:.01,clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.6,isTintEnabled:!1,tintColor:[0,0,0],tintThickness:1}},glass_windshield:{type:"glass",albedo:[.034230206565082,.0986891975410945,.034230206565082],metallic:.3,roughness:0,opacity:.3,thickness:.01,clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.6,isTintEnabled:!1,tintColor:[0,0,0],tintThickness:1}},glass_window:{type:"glass",albedo:[.034230206565082,.0986891975410945,.034230206565082],metallic:.3,roughness:0,opacity:.3,thickness:.01,clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.6,isTintEnabled:!1,tintColor:[0,0,0],tintThickness:1}},glass_taillight:{type:"glass",albedo:[.81224148989849,0,0],metallic:0,roughness:.05,opacity:.9,thickness:.01,clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.55,isTintEnabled:!0,tintColor:[.701169501531402,0,0],tintThickness:1}},ext_chrome:{type:"paint",albedo:[.870588235294118,.870588235294118,.870588235294118],metallic:.92,roughness:.23},magma:{type:"paint",albedo:[.722672453600254,.027755279978126,0],metallic:.8,roughness:.45,clearCoat:{isEnabled:!0,intensity:.75,roughness:.01,indexOfRefraction:1.6,isTintEnabled:!0,tintColor:[1,1,1],tintThickness:3}},magma_flake:{type:"flaked_paint_with_tint",albedo:[.722672453600254,.027755279978126,0],metallic:.8,roughness:.45,flakeScale:{u:100,v:100},normalStrength:{x:.025,y:.025},anisotropy:30,clearCoat:{isEnabled:!0,intensity:.75,roughness:.01,indexOfRefraction:1.6,isTintEnabled:!0,tintColor:[1,1,1],tintThickness:3}},btdf:{type:"paint",albedo:[.24313725490196,.258823529411764,.592156862745098],metallic:.7,roughness:.51,clearCoat:{isEnabled:!0,intensity:.9,roughness:.01,indexOfRefraction:1.5,isTintEnabled:!0,tintColor:[.0823529411764705,.501960784313725,.917647058823529],tintThickness:3}},btdf_flake:{type:"flaked_paint_with_tint",albedo:[.24313725490196,.258823529411764,.592156862745098],metallic:.7,roughness:.51,flakeScale:{u:100,v:100},normalStrength:{x:.025,y:.025},anisotropy:30,clearCoat:{isEnabled:!0,intensity:.9,roughness:.01,indexOfRefraction:1.5,isTintEnabled:!0,tintColor:[.0823529411764705,.501960784313725,.917647058823529],tintThickness:3}},tinted_carbon_fiber:{type:"tinted_carbon_fiber",metalness:.6,roughness:.4,clearcoat:1,clearcoatRoughness:.01,textureScale:{u:30,v:30},normalStrength:{x:.5,y:.5},clearCoat:{isEnabled:!0,intensity:.9,roughness:.4,isTintEnabled:!0,tintColor:[1,1,1],tintThickness:3}},matte_carbon_fiber:{type:"tinted_carbon_fiber",metalness:.5,roughness:.43,clearcoat:1,clearcoatRoughness:.37,textureScale:{u:30,v:30},normalStrength:{x:.5,y:.5},clearCoat:{isEnabled:!0,intensity:.75,roughness:.43,isTintEnabled:!0,tintColor:[1,1,1],tintThickness:3}}};class bt{constructor(e=512,t=512){const i=document.createElement("canvas");i.width=e,i.height=t;const n=i.getContext("2d");n.fillStyle="rgb(127,127,255)",n.fillRect(0,0,e,t);for(let a=0;a<5e3;a++){const s=Math.random()*e,r=Math.random()*t,o=Math.random()*3+4;let l=Math.random()*2-1,h=Math.random()*2-1,d=1.5;const u=Math.sqrt(l*l+h*h+d*d);l/=u,h/=u,d/=u,n.fillStyle="rgb("+(l*150+127)+","+(h*150+127)+","+d*255+")",n.beginPath(),n.arc(s,r,o,0,Math.PI*2),n.fill()}return i}}class yt{constructor(e=512,t=512){this.width=e,this.height=t,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),this.generateTexture()}generateTexture(){this.ctx.fillStyle="#2E2E2E",this.ctx.fillRect(0,0,this.width,this.height);const t=16/4,i=26,n=25,a=7,s=1,r=this.ctx.getImageData(0,0,this.width,this.height),o=r.data;for(let l=0;l<this.height;l++)for(let h=0;h<this.width;h++){const d=Math.floor(h/t)%4,u=Math.floor(l/t)%4,m=d===u||d===(u+1)%4;let p;m?p=i+n*.5+a*Math.sin(h/s*2*Math.PI):p=i+n*.5+a*Math.sin(l/s*2*Math.PI);const _=Math.random()*10-5;p+=_,p=Math.min(255,Math.max(0,p));const b=(l*this.width+h)*4;o[b]=p,o[b+1]=p,o[b+2]=p,o[b+3]=255}this.ctx.putImageData(r,0,0)}getTexture(){const e=new f.CanvasTexture(this.canvas);return e.wrapS=f.RepeatWrapping,e.wrapT=f.RepeatWrapping,e}}class _t{constructor(e=512,t=512){this.width=e,this.height=t,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),this.generateNormalMap()}generateNormalMap(){const s=new Float32Array(this.width*this.height);for(let l=0;l<this.height;l++)for(let h=0;h<this.width;h++){const d=Math.floor(h/4)%4,u=Math.floor(l/4)%4;d===u||d===(u+1)%4?s[l*this.width+h]=3*.5+.1*Math.sin(h/2*2*Math.PI):s[l*this.width+h]=3*-.5+.1*Math.sin(l/2*2*Math.PI)}const r=this.ctx.createImageData(this.width,this.height),o=r.data;for(let l=0;l<this.height;l++)for(let h=0;h<this.width;h++){const d=(h+1)%this.width,u=(h-1+this.width)%this.width,m=(l+1)%this.height,p=(l-1+this.height)%this.height,_=(s[l*this.width+d]-s[l*this.width+u])/2,b=(s[m*this.width+h]-s[p*this.width+h])/2;let w=-_,g=-b,T=1;const A=Math.sqrt(w*w+g*g+T*T);w/=A,g/=A,T/=A;const S=.5+.5*w,D=.5+.5*g,P=.5+.5*T,H=(l*this.width+h)*4;o[H]=S*255,o[H+1]=D*255,o[H+2]=P*255,o[H+3]=255}this.ctx.putImageData(r,0,0)}getTexture(){const e=new f.CanvasTexture(this.canvas);return e.wrapS=f.RepeatWrapping,e.wrapT=f.RepeatWrapping,e}}class be{static createMaterial(e,t){console.log(`Creating material with type: ${e}, data:`,t);const i=`${e}_${JSON.stringify(t)}`;if(this.materialCache.has(i))return this.materialCache.get(i);let n;switch(e){case"paint":n=this.createPaintMaterial(t);break;case"glass":n=this.createGlassMaterial(t);break;case"tinted_carbon_fiber":n=this.createTintedCarbonFiberMaterial(t);break;case"flaked_paint_with_tint":n=this.createFlakedPaintWithTintMaterial(t);break;default:console.warn(`Unknown material type: ${e}`),n=new f.MeshBasicMaterial({color:16711935}),n.userData.type=e}return this.materialCache.set(i,n),n}static createPaintMaterial(e){var i,n,a,s,r;const t=new f.MeshPhysicalMaterial({color:new f.Color(...e.albedo),metalness:e.metallic,roughness:e.roughness,clearcoat:(i=e.clearCoat)!=null&&i.isEnabled?e.clearCoat.intensity:0,clearcoatRoughness:((n=e.clearCoat)==null?void 0:n.roughness)||.1,thickness:((a=e.clearCoat)==null?void 0:a.tintThickness)||1,ior:e.indexOfRefraction||1.5,side:f.DoubleSide});return(s=e.clearCoat)!=null&&s.isTintEnabled&&(t.userData.tintColor=new f.Color(e.clearCoat.tintColor),t.userData.tintThickness=e.clearCoat.tintThickness||1,t.userData.clearcoatIntensity=e.clearCoat.intensity||.75,t.userData.clearcoatIor=((r=e.clearCoat)==null?void 0:r.indexOfRefraction)||1.5,t.onBeforeCompile=o=>{o.uniforms.tintColor={value:t.userData.tintColor},o.uniforms.tintThickness={value:t.userData.tintThickness},o.uniforms.clearcoatIntensity={value:t.userData.clearcoatIntensity},o.uniforms.clearcoatIor={value:t.userData.clearcoatIor},o.fragmentShader=o.fragmentShader.replace("#include <common>",`
          #include <common>
          uniform vec3 tintColor;
          uniform float tintThickness;
          uniform float clearcoatIntensity;
          uniform float clearcoatIor;
          `),o.fragmentShader=o.fragmentShader.replace("#include <clearcoat_fragment>",`
          #include <clearcoat_fragment>
          // Adjust clearcoat based on custom IOR (simplified example)
          float iorFactor = (clearcoatIor - 1.0) / (clearcoatIor + 1.0);
          clearcoat = clearcoat * (1.0 - iorFactor * (1.0 - cosTheta));
          `),o.fragmentShader=o.fragmentShader.replace("#include <color_fragment>",`
          #include <color_fragment>
          float cosTheta = abs(dot(normalize(vNormal), normalize(vViewPosition)));
          vec3 tintEffect = exp(-tintColor * tintThickness * clearcoatIntensity / max(cosTheta, 0.01));
          diffuseColor.rgb *= mix(vec3(0.9), tintEffect, clearcoatIntensity);
          `),t.userData.shader=o}),t.userData.type="paint",t}static createGlassMaterial(e){const t=new f.MeshPhysicalMaterial({color:new f.Color(...e.albedo),transmission:1,opacity:e.opacity,metalness:0,roughness:0,ior:1.5,thickness:e.thickness,specularIntensity:1,specularColor:new f.Color(16777215),envMapIntensity:1,transparent:!0,side:f.DoubleSide,shadowSide:f.DoubleSide});return t.userData.type="glass",t}static createCarbonFiberMaterial(e){var a,s,r,o,l,h;const t=new f.MeshPhysicalMaterial({roughness:e.roughness||.5,clearcoat:e.clearcoat||1,clearcoatRoughness:e.clearcoatRoughness||.1,metalness:e.metalness||.3,side:f.DoubleSide}),i=new yt().getTexture();i.repeat.set(((a=e.textureScale)==null?void 0:a.u)||10,((s=e.textureScale)==null?void 0:s.v)||10),t.map=i;const n=new _t().getTexture();return n.repeat.set(((r=e.textureScale)==null?void 0:r.u)||10,((o=e.textureScale)==null?void 0:o.v)||10),t.normalMap=n,t.normalScale=new f.Vector2(((l=e.normalStrength)==null?void 0:l.x)||2,((h=e.normalStrength)==null?void 0:h.y)||2),t.userData.type="carbon_fiber",t}static createFlakedPaintMaterial(e){var n,a,s,r;const t=new f.MeshPhysicalMaterial({clearcoat:e.clearcoat||1,clearcoatRoughness:e.clearcoatRoughness||.1,metalness:e.metalness||.9,roughness:e.roughness||.5,color:new f.Color(...e.albedo||[0,0,1]),side:f.DoubleSide}),i=new f.CanvasTexture(new bt);return i.wrapS=f.RepeatWrapping,i.wrapT=f.RepeatWrapping,i.repeat.set(((n=e.flakeScale)==null?void 0:n.u)||10,((a=e.flakeScale)==null?void 0:a.v)||6),i.anisotropy=e.anisotropy||16,t.normalMap=i,t.normalScale=new f.Vector2(((s=e.normalStrength)==null?void 0:s.x)||.15,((r=e.normalStrength)==null?void 0:r.y)||.15),t.userData.type="flaked_paint",t}static createTintedCarbonFiberMaterial(e){var a,s,r,o,l,h,d;const t=new f.MeshPhysicalMaterial({roughness:e.roughness||.5,clearcoat:e.clearcoat||1,clearcoatRoughness:e.clearcoatRoughness||.1,metalness:e.metalness||.3,side:f.DoubleSide}),i=new yt().getTexture();i.repeat.set(((a=e.textureScale)==null?void 0:a.u)||10,((s=e.textureScale)==null?void 0:s.v)||10),t.map=i;const n=new _t().getTexture();return n.repeat.set(((r=e.textureScale)==null?void 0:r.u)||10,((o=e.textureScale)==null?void 0:o.v)||10),t.normalMap=n,t.normalScale=new f.Vector2(((l=e.normalStrength)==null?void 0:l.x)||2,((h=e.normalStrength)==null?void 0:h.y)||2),(d=e.clearCoat)!=null&&d.isTintEnabled&&(t.userData.tintColor=new f.Color(...e.clearCoat.tintColor),t.userData.tintThickness=e.clearCoat.tintThickness||1,t.userData.clearcoatIntensity=e.clearCoat.intensity||.75,t.onBeforeCompile=u=>{u.uniforms.tintColor={value:t.userData.tintColor},u.uniforms.tintThickness={value:t.userData.tintThickness},u.uniforms.clearcoatIntensity={value:t.userData.clearcoatIntensity},u.fragmentShader=u.fragmentShader.replace("#include <common>",`
          #include <common>
          uniform vec3 tintColor;
          uniform float tintThickness;
          uniform float clearcoatIntensity;
          `),u.fragmentShader=u.fragmentShader.replace("#include <color_fragment>",`
          #include <color_fragment>
          float cosTheta = abs(dot(normalize(vNormal), normalize(vViewPosition)));
          vec3 tintEffect = exp(-tintColor * tintThickness * clearcoatIntensity / max(cosTheta, 0.01));
          diffuseColor.rgb *= mix(vec3(0.9), tintEffect, clearcoatIntensity);
          `),t.userData.shader=u}),t.userData.type="tinted_carbon_fiber",t}static createFlakedPaintWithTintMaterial(e){var n,a,s,r,o,l,h,d,u,m;const t=new f.MeshPhysicalMaterial({color:new f.Color(...e.albedo||[0,0,1]),metalness:e.metalness||.8,roughness:e.roughness||.45,clearcoat:(n=e.clearCoat)!=null&&n.isEnabled?e.clearCoat.intensity:0,clearcoatRoughness:((a=e.clearCoat)==null?void 0:a.roughness)||.1,side:f.DoubleSide}),i=new f.CanvasTexture(new bt);return i.wrapS=f.RepeatWrapping,i.wrapT=f.RepeatWrapping,i.repeat.set(((s=e.flakeScale)==null?void 0:s.u)||10,((r=e.flakeScale)==null?void 0:r.v)||6),i.anisotropy=e.anisotropy||16,t.normalMap=i,t.normalScale=new f.Vector2(((o=e.normalStrength)==null?void 0:o.x)||.15,((l=e.normalStrength)==null?void 0:l.y)||.15),t.userData.flakeMetalness=e.flakeMetalness||1,t.defines=t.defines||{},t.defines.USE_UV="",((h=e.clearCoat)!=null&&h.isTintEnabled||e.flakeMetalness!==void 0)&&(t.userData.tintColor=new f.Color(...((d=e.clearCoat)==null?void 0:d.tintColor)||[0,0,0]),t.userData.tintThickness=((u=e.clearCoat)==null?void 0:u.tintThickness)||1,t.userData.clearcoatIntensity=((m=e.clearCoat)==null?void 0:m.intensity)||.75,t.onBeforeCompile=p=>{var _;p.uniforms.tintColor={value:t.userData.tintColor},p.uniforms.tintThickness={value:t.userData.tintThickness},p.uniforms.clearcoatIntensity={value:t.userData.clearcoatIntensity},p.uniforms.flakeMetalness={value:t.userData.flakeMetalness},p.fragmentShader=p.fragmentShader.replace("#include <common>",`
            #include <common>
            uniform vec3 tintColor;
            uniform float tintThickness;
            uniform float clearcoatIntensity;
            uniform float clearcoatIor;
            `),p.fragmentShader=p.fragmentShader.replace("#include <clearcoat_fragment>",`
            #include <clearcoat_fragment>
            // Adjust clearcoat based on custom IOR (simplified example)
            float iorFactor = (clearcoatIor - 1.0) / (clearcoatIor + 1.0);
            clearcoat = clearcoat * (1.0 - iorFactor * (1.0 - cosTheta));
            `),(_=e.clearCoat)!=null&&_.isTintEnabled&&(p.fragmentShader=p.fragmentShader.replace("#include <color_fragment>",`
            #include <color_fragment>
            float cosTheta = abs(dot(normalize(vNormal), normalize(vViewPosition)));
            vec3 tintEffect = exp(-tintColor * tintThickness * clearcoatIntensity / max(cosTheta, 0.01));
            diffuseColor.rgb *= mix(vec3(0.9), tintEffect, clearcoatIntensity);
            `)),t.userData.shader=p}),t.userData.type="flaked_paint_with_tint",t}}Fe(be,"textureLoader",new f.TextureLoader),Fe(be,"materialCache",new Map);const wt={"154_Alluminio_Lucido":{"material name":"Alluminio Lucido",metallic:.8,roughness:.45,metallicF0Factor:1.8,albedo:[.415148091655906,.415148091655906,.415148091655906],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.6,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"39_Alluminio_Opaco":{"material name":"Alluminio Opaco",metallic:.81,roughness:.5,metallicF0Factor:.26,albedo:[.423529411764705,.423529411764705,.423529411764705],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:1.14,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"27_Alluminium":{"material name":"Alluminium",metallic:.91,roughness:.51,metallicF0Factor:0,albedo:[.498039215686274,.498039215686274,.498039215686274],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"05_Aluminium":{"material name":"Aluminium",metallic:.98,roughness:.48,metallicF0Factor:.98,albedo:[.772549019607843,.772549019607843,.772549019607843],clearCoat:{isEnabled:!1,intensity:1,roughness:0,indexOfRefraction:1.5,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"12_Argento_Nurburgring":{"material name":"Argento Nurburgring",metallic:.8,roughness:.45,metallicF0Factor:1.8,albedo:[.776470588235294,.780392156862745,.76078431372549],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.5,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"67_Argento_Nurburgring_opaco":{"material name":"Argento Nurburgring opaco",metallic:.81,roughness:.56,metallicF0Factor:.14,albedo:[.76078431372549,.917647058823529,.913725490196078],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:1.14,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"55_Avio":{"material name":"Avio",metallic:.11,roughness:.06,metallicF0Factor:.5,albedo:[.239215686274509,.0823529411764705,.0901960784313725],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"78_Avio_Metallizzato":{"material name":"Avio Metallizzato",metallic:.2,roughness:0,metallicF0Factor:1.5,albedo:[.0846415107254294,.0461488424223509,.0545922772817603],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!0,tintColor:[1,1,1],tintThickness:1}},"09_Avorio":{"material name":"Avorio",metallic:0,roughness:.01,metallicF0Factor:.5,albedo:[.6,.505882352941176,.301960784313725],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"106_Azzuro_Dino":{"material name":"Azzuro Dino",metallic:0,roughness:.01,metallicF0Factor:1,albedo:[.0429870101626571,.157280727890073,.585972983949661],clearCoat:{isEnabled:!0,intensity:.78,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"23_Azzurro_California":{"material name":"Azzurro California",metallic:.7,roughness:.49,metallicF0Factor:1,albedo:[.24680041960155,.585972983949661,.83552779146084],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"105_Azzurro_Met":{"material name":"Azzurro Met",metallic:.68,roughness:.1,metallicF0Factor:0,albedo:[.537254901960784,.76078431372549,.686274509803921],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:1.14,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"79_Azzurro_Metallizziato":{"material name":"Azzurro Metallizziato",metallic:.84,roughness:.45,metallicF0Factor:1,albedo:[.141980290685735,.173439036332135,.208359655960767],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"56_Azzurro_Monaco":{"material name":"Azzurro Monaco",metallic:.84,roughness:.23,metallicF0Factor:0,albedo:[.0745098039215686,.109803921568627,.156862745098039],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"47_Azzurro_Qao":{"material name":"Azzurro Qao",metallic:.84,roughness:.23,metallicF0Factor:0,albedo:[.0862745098039215,.125490196078431,.188235294117647],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"179_Bianco_Artico":{"material name":"Bianco Artico",metallic:.25,roughness:.06,metallicF0Factor:1,albedo:[.804559113894566,.948964938178195,.948964938178195],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"10_Bianco_Avus":{"material name":"Bianco Avus",metallic:0,roughness:.01,metallicF0Factor:1.51,albedo:[.701960784313725,.690196078431372,.572549019607843],clearCoat:{isEnabled:!0,intensity:.78,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"70_Bianco_Cervino":{"material name":"Bianco Cervino",metallic:0,roughness:.06,metallicF0Factor:.5,albedo:[.745098039215686,.745098039215686,.737254901960784],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"37_Bianco_Fuji":{"material name":"Bianco Fuji",metallic:0,roughness:.06,metallicF0Factor:.5,albedo:[.745098039215686,.745098039215686,.737254901960784],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!0,tintColor:[1,1,1],tintThickness:1}},"30_Bianco_Italia":{"material name":"Bianco Italia",metallic:0,roughness:.02,metallicF0Factor:.48,albedo:[.811764705882352,.835294117647058,.729411764705882],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"159_Bianco_Italia_Opaco":{"material name":"Bianco Italia Opaco",metallic:.81,roughness:.5,metallicF0Factor:.26,albedo:[.811764705882352,.835294117647058,.729411764705882],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!0,tintColor:[1,1,1],tintThickness:1}},"156_Bianco_King":{"material name":"Bianco King",metallic:0,roughness:.06,metallicF0Factor:.5,albedo:[.745098039215686,.745098039215686,.737254901960784],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"21_Blu_Abu_Dhabi":{"material name":"Blu Abu Dhabi",metallic:.8,roughness:.51,metallicF0Factor:1.8,albedo:[.0117647058823529,.0901960784313725,.2],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.5,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"48_Blu_America":{"material name":"Blu America",metallic:.84,roughness:.23,metallicF0Factor:0,albedo:[0,.149019607843137,.4],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"80_Blu_California":{"material name":"Blu California",metallic:.55,roughness:.25,metallicF0Factor:1,albedo:[.24680041960155,.585972983949661,.819963705323527],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"66_Blu_Corsa":{"material name":"Blu Corsa",metallic:.9,roughness:.51,metallicF0Factor:0,albedo:[.141176470588235,.439215686274509,.984313725490196],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.4,isTintEnabled:!0,tintColor:[.227450980392156,.68235294117647,.952941176470588],tintThickness:6.2}},"66_Blu_Corsa_Opaco":{"material name":"Blu Corsa Opaco",metallic:.81,roughness:.56,metallicF0Factor:1,albedo:[.0677245896854243,.227136525505148,.827725794455033],clearCoat:{isEnabled:!1,intensity:1,roughness:.01,indexOfRefraction:1.4,isTintEnabled:!0,tintColor:[.227450980392156,.68235294117647,.952941176470588],tintThickness:6.2}},"39_Blu_Elettrico":{"material name":"Blu Elettrico",metallic:0,roughness:.65,metallicF0Factor:.5,albedo:[.0134733969401426,.0160677008908868,.052841625522879],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:3,isTintEnabled:!1,tintColor:[.188235294117647,.0745098039215686,.00392156862745098],tintThickness:1}},"74_Blu_Elettrico_2020":{"material name":"Blu Elettrico 2020",metallic:0,roughness:.01,metallicF0Factor:0,albedo:[.00392156862745098,.0196078431372549,.0941176470588235],clearCoat:{isEnabled:!0,intensity:.3,roughness:.01,indexOfRefraction:1.45,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"59_Blu_Elettrico":{"material name":"Blu Elettrico Opaco",metallic:.51,roughness:.08,metallicF0Factor:1,albedo:[.325490196078431,.239215686274509,.929411764705882],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.29,isTintEnabled:!0,tintColor:[.00392156862745098,.788235294117647,.788235294117647],tintThickness:1}},"52_Blu_Le_Mans":{"material name":"Blu Le Mans",metallic:.84,roughness:.27,metallicF0Factor:0,albedo:[.00392156862745098,.141176470588235,.396078431372549],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"22_Blu_Mirabeau":{"material name":"Blu Mirabeau",metallic:.8,roughness:.45,metallicF0Factor:1,albedo:[.141980290685735,.358653905926198,.409825738436323],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!0,tintColor:[.0274509803921568,.0274509803921568,.219607843137254],tintThickness:1}},"46_Blu_Nart":{"material name":"Blu Nart",metallic:.84,roughness:.4,metallicF0Factor:0,albedo:[.00392156862745098,.24313725490196,.568627450980392],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.46,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"20_Blu_Pozzi":{"material name":"Blu Pozzi",metallic:0,roughness:.06,metallicF0Factor:2,albedo:[.0117647058823529,.0392156862745098,.0862745098039215],clearCoat:{isEnabled:!0,intensity:.5,roughness:0,indexOfRefraction:2,isTintEnabled:!1,tintColor:[.501960784313725,1,1],tintThickness:0}},"94_Blu_Roma":{"material name":"Blu Roma",metallic:.92,roughness:.29,metallicF0Factor:1.8,albedo:[.284452061560024,.447870841800409,.694080519796882],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.5,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"26_Blu_Scozia":{"material name":"Blu Scozia",metallic:0,roughness:.05,metallicF0Factor:.5,albedo:[.0392156862745098,.0470588235294117,.113725490196078],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.44,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"97_Blu_Scozia_Mica":{"material name":"Blu Scozia Mica",metallic:0,roughness:.05,metallicF0Factor:1.5,albedo:[.01698805208925,.0220129949193365,.0370285141619602],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.44,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"25_Blu_Swaters":{"material name":"Blu Swaters",metallic:.8,roughness:.6,metallicF0Factor:1,albedo:[.403921568627451,.545098039215686,.803921568627451],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.55,isTintEnabled:!0,tintColor:[.278431372549019,.309803921568627,.56078431372549],tintThickness:6.8}},"24_Blu_tour_de_France":{"material name":"Blu tour de France",metallic:.7,roughness:.51,metallicF0Factor:1.8,albedo:[.24313725490196,.258823529411764,.592156862745098],clearCoat:{isEnabled:!0,intensity:.9,roughness:.01,indexOfRefraction:1.5,isTintEnabled:!0,tintColor:[.0823529411764705,.501960784313725,.917647058823529],tintThickness:3}},"15_Canna_di_Fucile":{"material name":"Canna di Fucile",metallic:.8,roughness:.15,metallicF0Factor:.8,albedo:[.737254901960784,.737254901960784,.76078431372549],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.29,isTintEnabled:!0,tintColor:[.498039215686274,.498039215686274,.498039215686274],tintThickness:1}},"75_Canna_di_Fucile_Matt":{"material name":"Canna di Fucile Matt",metallic:0,roughness:.53,metallicF0Factor:1.8,albedo:[.0189129834237215,.0189129834237215,.0189129834237215],clearCoat:{isEnabled:!0,intensity:1,roughness:.55,indexOfRefraction:1.64,isTintEnabled:!0,tintColor:[.498039215686274,.498039215686274,.498039215686274],tintThickness:1}},"177_Celeste_f169":{"material name":"Celeste f169",metallic:.5,roughness:.5,metallicF0Factor:1,albedo:[.227136525505148,.334457807923889,.339223334935326],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:2,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"57_Celeste_met":{"material name":"Celeste met",metallic:.65,roughness:.6,metallicF0Factor:1,albedo:[.136098549737202,.23489525921588,.227136525505148],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:1.14,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},f171_Ferrari_Metal_titanio:{"material name":"Ferrari Metal titanio",metallic:1,roughness:.25,metallicF0Factor:1,albedo:[.547993502196971,.547993502196971,.547993502196971],clearCoat:{isEnabled:!1,intensity:1,roughness:0,indexOfRefraction:1.5,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"04_Ferrari_Metal_titanio_matt":{"material name":"Ferrari Metal titanio matt",metallic:0,roughness:0,metallicF0Factor:1,albedo:[.32156862745098,.32156862745098,.32156862745098],clearCoat:{isEnabled:!1,intensity:1,roughness:0,indexOfRefraction:1.5,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"01_Giallo_Modena":{"material name":"Giallo Modena",metallic:0,roughness:.01,metallicF0Factor:1,albedo:[.638779455650816,.37867625092984,.000175123977503026],clearCoat:{isEnabled:!0,intensity:.78,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"07_Giallo_Modena":{"material name":"Giallo Modena",metallic:0,roughness:0,metallicF0Factor:.5,albedo:[.701960784313725,.431372549019607,0],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"01_Giallo_Modena_Opaco":{"material name":"Giallo Modena Opaco",metallic:0,roughness:.56,metallicF0Factor:1,albedo:[.638779455650816,.37867625092984,.000175123977503026],clearCoat:{isEnabled:!1,intensity:.78,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"73_Giallo_Montecarlo":{"material name":"Giallo Montecarlo",metallic:1,roughness:.6,metallicF0Factor:0,albedo:[.901960784313725,.576470588235294,.0235294117647058],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.45,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"31_Giallo_Triplo_Strato":{"material name":"Giallo Triplo Strato",metallic:.4,roughness:.11,metallicF0Factor:.5,albedo:[.890196078431372,.670588235294117,.00784313725490196],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:10}},"121_Green_Jewel":{"material name":"Green Jewel",metallic:.85,roughness:.55,metallicF0Factor:1.8,albedo:[0,.24680041960155,.157280727890073],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.6,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"162_Grigio_812S_Opaco":{"material name":"Grigio 812S Opaco",metallic:.79,roughness:.53,metallicF0Factor:1,albedo:[.166872271890765,.170138373223312,.176774321640903],clearCoat:{isEnabled:!0,intensity:1,roughness:.05,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.645555272444934,.645555272444934,.645555272444934],tintThickness:1}},"45_Grigio_Abu_Dhabi":{"material name":"Grigio Abu Dhabi",metallic:.84,roughness:.4,metallicF0Factor:0,albedo:[.196078431372549,.2,.192156862745098],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"71_Grigio_Alfieri":{"material name":"Grigio Alfieri",metallic:.83,roughness:.25,metallicF0Factor:1,albedo:[.388910256539058,.388910256539058,.383774646487975],clearCoat:{isEnabled:!0,intensity:1,roughness:.07,indexOfRefraction:2.37,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"11_Grigio_Alloy":{"material name":"Grigio Alloy",metallic:.8,roughness:.51,metallicF0Factor:1.8,albedo:[.541176470588235,.662745098039215,.674509803921568],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.5,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"77_Grigio_Competizione":{"material name":"Grigio Competizione",metallic:.8,roughness:.45,metallicF0Factor:1.8,albedo:[.254915856566385,.275832833461245,.271577415438375],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.44,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"03_grigio_corsa_glossy":{"material name":"grigio corsa glossy",metallic:.76,roughness:.12,metallicF0Factor:1.89,albedo:[.52156862745098,.52156862745098,.52156862745098],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"07_Grigio_Ferro":{"material name":"Grigio Ferro",metallic:.8,roughness:.15,metallicF0Factor:.8,albedo:[.290196078431372,.266666666666666,.250980392156862],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.4,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"08_Grigio_Ingrid":{"material name":"Grigio Ingrid",metallic:.8,roughness:.45,metallicF0Factor:1.8,albedo:[.619607843137254,.549019607843137,.419607843137254],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.5,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"49_Grigio_Medio":{"material name":"Grigio Medio",metallic:0,roughness:.1,metallicF0Factor:.5,albedo:[.0666666666666666,.0666666666666666,.0666666666666666],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"72_Grigio_QAO":{"material name":"Grigio QAO",metallic:.92,roughness:.39,metallicF0Factor:.8,albedo:[.0627450980392156,.172549019607843,.341176470588235],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0745098039215686,.556862745098039,.917647058823529],tintThickness:1}},"17_Grigio_Scuro":{"material name":"Grigio Scuro",metallic:0,roughness:.08,metallicF0Factor:.5,albedo:[.0862745098039215,.0862745098039215,.0784313725490196],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"23_Grigio_Scuro":{"material name":"Grigio Scuro",metallic:0,roughness:.65,metallicF0Factor:.5,albedo:[.0823529411764705,.0823529411764705,.0823529411764705],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:3,isTintEnabled:!1,tintColor:[.188235294117647,.0745098039215686,.00392156862745098],tintThickness:1}},"06_Grigio_Silverstone":{"material name":"Grigio Silverstone",metallic:.9,roughness:.4,metallicF0Factor:.5,albedo:[.615686274509804,.615686274509804,.615686274509804],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"14_Grigio_Silverstone":{"material name":"Grigio Silverstone",metallic:.8,roughness:.2,metallicF0Factor:2,albedo:[.113725490196078,.113725490196078,.113725490196078],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.5,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"40_Grigio_Silverstone_Opaco":{"material name":"Grigio Silverstone Opaco",metallic:.81,roughness:.56,metallicF0Factor:.14,albedo:[.266666666666666,.254901960784313,.254901960784313],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:1.14,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"13_Grigio_Titantio_Metallizato":{"material name":"Grigio Titantio Metallizato",metallic:.8,roughness:.45,metallicF0Factor:1.8,albedo:[.384313725490196,.435294117647058,.450980392156862],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.6,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"10_Nero":{"material name":"Nero",metallic:0,roughness:.09,metallicF0Factor:0,albedo:[.0313725490196078,.0313725490196078,.0313725490196078],clearCoat:{isEnabled:!0,intensity:1,roughness:.15,indexOfRefraction:1.46,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"16_Nero_Daytona":{"material name":"Nero Daytona",metallic:.46,roughness:.41,metallicF0Factor:.39,albedo:[.01698805208925,.01698805208925,.01698805208925],clearCoat:{isEnabled:!0,intensity:.47,roughness:0,indexOfRefraction:1.4,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"19_Nero_DS_1250":{"material name":"Nero DS 1250",metallic:0,roughness:.06,metallicF0Factor:2,albedo:[0,0,0],clearCoat:{isEnabled:!0,intensity:.5,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"41_Nero_Opaco":{"material name":"Nero Opaco",metallic:0,roughness:.43,metallicF0Factor:0,albedo:[.0196078431372549,.0196078431372549,.0196078431372549],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:1.14,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"163_Nero_Purosangue":{"material name":"Nero Purosangue",metallic:0,roughness:.01,metallicF0Factor:2,albedo:[.01698805208925,.0179364333399502,.0253712769047345],clearCoat:{isEnabled:!0,intensity:1,roughness:.1,indexOfRefraction:1,isTintEnabled:!0,tintColor:[1,.819963705323527,.819963705323527],tintThickness:5}},"61_Nero_Stellato":{"material name":"Nero Stellato",metallic:0,roughness:.1,metallicF0Factor:0,albedo:[.00392156862745098,.00392156862745098,.00392156862745098],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"109_Nuovo_Azzurro_La_Plata":{"material name":"Nuovo Azzurro La Plata",metallic:0,roughness:.01,metallicF0Factor:1,albedo:[.311180499057984,.652370105410821,.722672453600254],clearCoat:{isEnabled:!0,intensity:.78,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"109_Nuovo_Azzurro_La_Plata_Opaco":{"material name":"Nuovo Azzurro La Plata Opaco",metallic:0,roughness:.56,metallicF0Factor:1,albedo:[.23489525921588,.618685727498779,.701169501531402],clearCoat:{isEnabled:!1,intensity:.78,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"64_Rosso_70_Anni":{"material name":"Rosso 70 Anni",metallic:0,roughness:.1,metallicF0Factor:.5,albedo:[.701960784313725,0,0],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"53_Rosso_Barchetta":{"material name":"Rosso Barchetta",metallic:.48,roughness:.21,metallicF0Factor:0,albedo:[.470588235294117,.0392156862745098,.0470588235294117],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:1.14,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"36_Rosso_Berlinetta":{"material name":"Rosso Berlinetta",metallic:.8,roughness:.6,metallicF0Factor:1,albedo:[.859173569658532,.127529777813422,.127529777813422],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:2.05,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"29_Rosso_California":{"material name":"Rosso California",metallic:0,roughness:.1,metallicF0Factor:.5,albedo:[.270588235294117,.00392156862745098,.0117647058823529],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"03_Rosso_Corsa":{"material name":"Rosso Corsa",metallic:0,roughness:.01,metallicF0Factor:1,albedo:[.652370105410821,.0220129949193365,0],clearCoat:{isEnabled:!0,intensity:.71,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"04_Rosso_Corsa":{"material name":"Rosso Corsa",metallic:0,roughness:.01,metallicF0Factor:1,albedo:[.650980392156862,0,0],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"04_Rosso_Corsa_met":{"material name":"Rosso Corsa met",metallic:.7,roughness:.51,metallicF0Factor:.7,albedo:[.494117647058823,.00392156862745098,.00392156862745098],clearCoat:{isEnabled:!0,intensity:.51,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"02_Rosso_Dino":{"material name":"Rosso Dino",metallic:0,roughness:0,metallicF0Factor:.45,albedo:[.619607843137254,.0431372549019607,0],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"161_Rosso_F1-75_Opaco":{"material name":"Rosso F1-75 Opaco",metallic:.25,roughness:.47,metallicF0Factor:1,albedo:[.45907989242416,.0199178384387857,.0199178384387857],clearCoat:{isEnabled:!0,intensity:1,roughness:.95,indexOfRefraction:1.4,isTintEnabled:!0,tintColor:[1,.0619074756054557,.00455975492252602],tintThickness:1}},"06_Rosso_Fiorano":{"material name":"Rosso Fiorano",metallic:.8,roughness:.51,metallicF0Factor:.8,albedo:[.376470588235294,.00784313725490196,0],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.51,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"34_Rosso_Formula1_2007":{"material name":"Rosso Formula1 2007",metallic:.62,roughness:.22,metallicF0Factor:0,albedo:[1,.0235294117647058,0],clearCoat:{isEnabled:!0,intensity:.85,roughness:.01,indexOfRefraction:1,isTintEnabled:!0,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:2}},"35_Rosso_Fuoco":{"material name":"Rosso Fuoco",metallic:.62,roughness:.1,metallicF0Factor:0,albedo:[1,.0117647058823529,0],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"83_Rosso_Imola":{"material name":"Rosso Imola",metallic:.8,roughness:.5,metallicF0Factor:1,albedo:[.875137582365204,.0494334575559079,0],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"164_Rosso_Le_Mans_Opaco":{"material name":"Rosso Le Mans Opaco",metallic:0,roughness:.2,metallicF0Factor:1,albedo:[1,.101145164209599,.0328759169483838],clearCoat:{isEnabled:!1,intensity:1,roughness:.95,indexOfRefraction:1.4,isTintEnabled:!0,tintColor:[1,.0619074756054557,.00455975492252602],tintThickness:1}},"130_Rosso_Magma":{"material name":"Rosso Magma",metallic:.8,roughness:.45,metallicF0Factor:1.8,albedo:[.722672453600254,.027755279978126,0],clearCoat:{isEnabled:!0,intensity:.75,roughness:0,indexOfRefraction:1.6,isTintEnabled:!0,tintColor:[1,1,1],tintThickness:1}},"42_Rosso_Maranello":{"material name":"Rosso Maranello",metallic:.8,roughness:.2,metallicF0Factor:1,albedo:[.523443155214324,.113920933406332,.108711149979038],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.51,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"33_Rosso_Monza":{"material name":"Rosso Monza",metallic:0,roughness:.1,metallicF0Factor:.5,albedo:[.529411764705882,0,0],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"05_Rosso_Mugello":{"material name":"Rosso Mugello",metallic:0,roughness:0,metallicF0Factor:1.51,albedo:[.207843137254901,0,0],clearCoat:{isEnabled:!0,intensity:.78,roughness:0,indexOfRefraction:1.5,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"64_Rosso_Portofino":{"material name":"Rosso Portofino",metallic:.77,roughness:.46,metallicF0Factor:0,albedo:[.658823529411764,.0901960784313725,.0901960784313725],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.51,isTintEnabled:!0,tintColor:[.874509803921568,.141176470588235,.156862745098039],tintThickness:6.2}},"03_Rosso_Scuderia":{"material name":"Rosso Scuderia",metallic:0,roughness:0,metallicF0Factor:1.51,albedo:[.650980392156862,.0235294117647058,0],clearCoat:{isEnabled:!0,intensity:.78,roughness:0,indexOfRefraction:1.5,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"04_Rosso_Scuderia":{"material name":"Rosso Scuderia",metallic:0,roughness:0,metallicF0Factor:.5,albedo:[.650980392156862,.0235294117647058,0],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"54_Rubino_Micalizzato":{"material name":"Rubino Micalizzato",metallic:.84,roughness:.22,metallicF0Factor:0,albedo:[.211764705882352,.0470588235294117,.0470588235294117],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"114_Sanusilver":{"material name":"Sanusilver",metallic:.85,roughness:.5,metallicF0Factor:1.8,albedo:[.652370105410821,.652370105410821,.652370105410821],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.6,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"65_Superfast_Opaco":{"material name":"Superfast Opaco",metallic:.81,roughness:.65,metallicF0Factor:.14,albedo:[.376470588235294,.368627450980392,.368627450980392],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:1.14,isTintEnabled:!1,tintColor:[.0235294117647058,.0274509803921568,.0588235294117647],tintThickness:1}},"25_Verde":{"material name":"Verde",metallic:0,roughness:.65,metallicF0Factor:.5,albedo:[.0117647058823529,.0627450980392156,.0156862745098039],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:3,isTintEnabled:!1,tintColor:[.188235294117647,.0745098039215686,.00392156862745098],tintThickness:1}},"18_Verde_British":{"material name":"Verde British",metallic:0,roughness:.06,metallicF0Factor:.5,albedo:[.00392156862745098,.0470588235294117,.0313725490196078],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.44,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"122_Verde_Kers":{"material name":"Verde Kers",metallic:.5,roughness:.05,metallicF0Factor:1.5,albedo:[.190462878822409,.358653905926198,.0494334575559079],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"120_Verde_Masoni":{"material name":"Verde Masoni",metallic:.85,roughness:.4,metallicF0Factor:1.8,albedo:[.173439036332135,.173439036332135,.0780565899581018],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.6,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"119_Verde_Medio_Met":{"material name":"Verde Medio Met",metallic:.4,roughness:.11,metallicF0Factor:1.5,albedo:[.0891935068622478,.141980290685735,.0891935068622478],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"123_Verde_Pino_18":{"material name":"Verde Pino 18",metallic:.85,roughness:.6,metallicF0Factor:1.8,albedo:[.012663720031582,.127529777813422,.101145164209599],clearCoat:{isEnabled:!0,intensity:1,roughness:0,indexOfRefraction:1.6,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"43_Verde_Racing":{"material name":"Verde Racing",metallic:0,roughness:.09,metallicF0Factor:.5,albedo:[.00392156862745098,.0431372549019607,.0196078431372549],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"50_Verde_Zeltweg":{"material name":"Verde Zeltweg",metallic:0,roughness:.1,metallicF0Factor:.5,albedo:[.00392156862745098,.00784313725490196,.00392156862745098],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"38_Vinaccia":{"material name":"Vinaccia",metallic:0,roughness:.65,metallicF0Factor:.5,albedo:[.0352941176470588,.0235294117647058,.0235294117647058],clearCoat:{isEnabled:!1,intensity:1,roughness:1,indexOfRefraction:3,isTintEnabled:!0,tintColor:[.188235294117647,.0745098039215686,.00392156862745098],tintThickness:1}},"51_Vinaccia":{"material name":"Vinaccia",metallic:0,roughness:.09,metallicF0Factor:.5,albedo:[.0352941176470588,0,0],clearCoat:{isEnabled:!0,intensity:.5,roughness:.01,indexOfRefraction:1,isTintEnabled:!1,tintColor:[1,1,1],tintThickness:1}},"93_Viola_Hong_Kong":{"material name":"Viola Hong Kong",metallic:.75,roughness:0,metallicF0Factor:2,albedo:[.409825738436323,.0780565899581018,.24680041960155],clearCoat:{isEnabled:!0,intensity:1,roughness:.01,indexOfRefraction:1.29,isTintEnabled:!0,tintColor:[.00392156862745098,.788235294117647,.788235294117647],tintThickness:1}},"92_Violetto_Dino":{"material name":"Violetto Dino",metallic:.6,roughness:.55,metallicF0Factor:2,albedo:[.409825738436323,.0891935068622478,.24680041960155],clearCoat:{isEnabled:!0,intensity:.92,roughness:.01,indexOfRefraction:1.29,isTintEnabled:!0,tintColor:[.00392156862745098,.788235294117647,.788235294117647],tintThickness:4}},"":{"material name":"",metallic:0,roughness:0,metallicF0Factor:0,albedo:[0],clearCoat:{isEnabled:!1,intensity:0,roughness:0,indexOfRefraction:0,isTintEnabled:!1,tintColor:[0,0,0],tintThickness:0}}};function zt(c,e,t=Bt){const i={},n={};for(const a in e){const s=e[a];if(console.log(`Processing part: ${a}, value: ${s}`),!s||s==="0"||s===null){n[a]=s;continue}if(wt[s])i[a]=be.createMaterial("paint",wt[s]);else if(t[s])if("opacity"in t[s])i[a]=be.createMaterial("glass",t[s]);else{const r=t[s].type||"paint";i[a]=be.createMaterial(r,t[s])}else console.error(`Material ${s} not found for part ${a}`)}c.traverse(a=>{var s;if(a.isMesh){const r=((s=a.material)==null?void 0:s.name)||a.name;if(i[r])a.material=i[r],a.castShadow=a.material.userData.type!=="glass",a.receiveShadow=!0;else if(n[r]==="0"){const o=a.parent;if(o){const l=o.children.find(h=>h.isMesh);l&&l.material&&(a.material=l.material,a.castShadow=!0,a.receiveShadow=!0)}}else n[r]===null&&(a.visible=!1)}})}const _e={},$n="/assets/model/";async function Vn(c){const e=await fetch("/assets/data/cars.json");if(!e.ok)throw new Error(`Error fetching car data: ${e.status}`);const i=(await e.json()).find(n=>n.VIN===c);if(!i)throw new Error(`Car with VIN ${c} not found`);return i}async function Tt(c,e="ZF00"){const t=await Vn(e),i=t.FModel,n=`${$n}${i}.glb`,a=new Ht;a.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.7/");const s=new Ot(c);s.setDRACOLoader(a);let r;if(_e[i])console.log(`Reusing cached car model for VIN ${e} (FModel: ${i})`),r=_e[i].clone();else{console.log(`Loading car model from ${n} for VIN ${e} (FModel: ${i})`);const o=await s.loadAsync(n);_e[i]=o.scene,_e[i].traverse(l=>{l.isMesh&&(l.castShadow=!0,l.receiveShadow=!0)}),r=_e[i].clone()}return zt(r,t.autoPaint,Bt),r}const me={geometry:new Map,setup:new Map},Kn={concrete:{type:"paint",albedo:[.7,.7,.7],roughness:.8,metallic:0},asphalt:{type:"paint",albedo:[.2,.2,.2],roughness:.9,metallic:0},grass:{type:"leather",albedo:[.1,.5,.1],diffuseMap:"/textures/grass_diffuse.jpg",roughness:.7,metallic:0}};async function Wn(c){return{city:{building:"concrete",road:"asphalt",lawn:"grass",bench:"0",sign:null},studio:{floor:"concrete",wall:"concrete"}}[c]||{}}async function At(c,e){const t=new Ht;t.setDecoderPath("https://unpkg.com/three@0.160.0/examples/jsm/libs/draco/");const i=new Ot(e);i.setDRACOLoader(t);const n=`/assets/scene/${c}.glb`;let a;me.geometry.has(c)?a=me.geometry.get(c):(console.log(`Loading geometry for scene ${c}`),a=(await i.loadAsync(n)).scene,me.geometry.set(c,a));const s=`/assets/scene/${c}_setup.glb`;let r;me.setup.has(c)?r=me.setup.get(c):(console.log(`Loading setup for scene ${c}`),r=(await i.loadAsync(s)).scene,me.setup.set(c,r));const o=new f.Group;o.name=c,a.traverse(d=>{d.isMesh&&(d.receiveShadow=!0,d.castShadow=!0,o.add(d.clone()))});const l=.006;r.traverse(d=>{if(d.isLight){const u=d.clone();u.intensity*=l,u.castShadow=!0,(u.type==="DirectionalLight"||u.type==="SpotLight"||u.type==="PointLight")&&(u.shadow.mapSize.width=2048,u.shadow.mapSize.height=2048,u.shadow.bias=-1e-4,u.shadow.normalBias=.001,u.shadow.camera.near=.1,u.shadow.camera.far=100),o.add(u)}else d.isCamera&&o.add(d.clone())});const h=await Wn(c);return zt(o,h,Kn),{sceneGroup:o}}class Xn{constructor(e){this.world=e,this.loadedScenes={test:null,city:null,studio:null,showroom:null,poster1:null,poster2:null},this.availableCameras=[],this.currentScene=null,this.targetPosition=null}async init(e){try{const t=await Tt(this.world.loadingManager,e);if(!t)throw new Error("Car loading returned null");this.world.car=t,this.world.car.position.set(0,0,0),this.world.scene.add(this.world.car);const i=new f.Box3().setFromObject(this.world.car),n=new f.Vector3;i.getCenter(n);const{sceneGroup:a}=await At(this.world.params.currentScene,this.world.loadingManager);this.loadedScenes[this.world.params.currentScene]={sceneGroup:a,targetPosition:n},await this.loadScene(a,n)}catch(t){console.error("Failed to initialize scene:",t),this.world.car=new f.Object3D,this.world.scene.add(this.world.car),new f.Box3().setFromObject(this.world.car);const i=new f.Vector3(0,0,0),n=new f.Group;this.loadedScenes[this.world.params.currentScene]={sceneGroup:n,targetPosition:i},await this.loadScene(n,i)}this.world.loadingBar.style.display="none"}async reloadCar(e){console.log(`Recarregando carro com VIN ${e}`),this.world.loadingBar.style.display="block",this.world.loop.stop(),this.world.car&&this.world.scene.remove(this.world.car);try{const t=await Tt(this.world.loadingManager,e);if(!t)throw new Error("New car loading returned null");this.world.car=t,this.world.car.position.set(0,0,0),this.world.scene.add(this.world.car);const i=new f.Box3().setFromObject(this.world.car),n=new f.Vector3;i.getCenter(n),this.targetPosition=n,this.world.controls.target.copy(n),this.world.controls.update()}catch(t){console.error("Failed to reload car:",t),this.world.car=new f.Object3D,this.world.scene.add(this.world.car),this.targetPosition=new f.Vector3(0,0,0),this.world.controls.target.set(0,0,0),this.world.controls.update()}this.world.loadingBar.style.display="none",this.world.loop.start(),this.world.loop.pauseAfterDelay(1500)}async loadScene(e,t){if(e instanceof f.Object3D?(this.currentScene&&(this.world.scene.remove(this.currentScene),this.world.spotlightHelper&&(this.world.scene.remove(this.world.spotlightHelper),this.world.spotlightHelper=null)),this.currentScene=e,this.world.scene.add(this.currentScene)):(console.error("loadScene: Invalid sceneGroup",e),this.currentScene=new f.Group,this.world.scene.add(this.currentScene)),t?(this.targetPosition=t,this.world.controls.target.copy(t)):(console.warn("Target position not provided, using default (0, 0, 0)"),this.targetPosition=new f.Vector3(0,0,0),this.world.controls.target.set(0,0,0)),this.world.controls.update(),this.availableCameras=[],this.currentScene.traverse(i=>{i.isCamera&&this.availableCameras.push(i)}),this.availableCameras.length>0){const i=this.availableCameras[0];this.world.camera.position.copy(i.position),this.world.camera.quaternion.copy(i.quaternion),this.world.camera.fov=i.fov,this.world.camera.updateProjectionMatrix(),this.applyCameraParameters()}else console.warn("No cameras found in the scene"),this.world.camera.position.set(-5,5,5),this.world.camera.updateProjectionMatrix();this.currentScene.spotlight&&(this.world.studioSpotlight=this.currentScene.spotlight,this.world.spotlightHelper=new f.SpotLightHelper(this.world.studioSpotlight),this.world.scene.add(this.world.spotlightHelper),this.world.spotlightHelper.visible=!1),this.world.lightingManager.setLightingMode(this.world.params.lightingMode),this.world.rendererManager.setExposure(this.world.params.exposure,this.currentScene,this.world.lightingManager.ambientLight,this.world.lightingManager.dynamicSky),this.world.rendererManager.updateShadows()}async switchScene(e){if(this.world.loadingBar.style.display="block",!this.loadedScenes[e])try{const{sceneGroup:t}=await At(e,this.world.loadingManager);this.loadedScenes[e]={sceneGroup:t,targetPosition:this.targetPosition}}catch(t){console.error("Failed to load scene:",t),this.loadedScenes[e]={sceneGroup:new f.Group,targetPosition:this.targetPosition}}await this.loadScene(this.loadedScenes[e].sceneGroup,this.targetPosition),this.world.params.currentScene=e,this.world.loadingBar.style.display="none"}applyCameraParameters(){if(this.availableCameras.length>0){const e=this.availableCameras[0],t=this.world.controls;console.log("Camera userData:",e.userData),t.minDistance=e.userData.minDistance||1,t.maxDistance=e.userData.maxDistance||100;const i=n=>n*Math.PI/180;t.minPolarAngle=e.userData.minPolarAngle!==void 0?i(e.userData.minPolarAngle):0,t.maxPolarAngle=e.userData.maxPolarAngle!==void 0?i(e.userData.maxPolarAngle):Math.PI,t.enablePan=e.userData.enablePan===!0||e.userData.enablePan==="true",t.update()}}}class Pe extends ke{constructor(){const e=Pe.SkyShader,t=new vi({name:e.name,uniforms:Li.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:Ri,depthWrite:!1});super(new ki(1,1,1),t),this.isSky=!0}}Pe.SkyShader={name:"SkyShader",uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new F},up:{value:new F(0,1,0)}},vertexShader:`
		uniform vec3 sunPosition;
		uniform float rayleigh;
		uniform float turbidity;
		uniform float mieCoefficient;
		uniform vec3 up;

		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		// constants for atmospheric scattering
		const float e = 2.71828182845904523536028747135266249775724709369995957;
		const float pi = 3.141592653589793238462643383279502884197169;

		// wavelength of used primaries, according to preetham
		const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
		// this pre-calculation replaces older TotalRayleigh(vec3 lambda) function:
		// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
		const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

		// mie stuff
		// K coefficient for the primaries
		const float v = 4.0;
		const vec3 K = vec3( 0.686, 0.678, 0.666 );
		// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
		const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

		// earth shadow hack
		// cutoffAngle = pi / 1.95;
		const float cutoffAngle = 1.6110731556870734;
		const float steepness = 1.5;
		const float EE = 1000.0;

		float sunIntensity( float zenithAngleCos ) {
			zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
			return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
		}

		vec3 totalMie( float T ) {
			float c = ( 0.2 * T ) * 10E-18;
			return 0.434 * c * MieConst;
		}

		void main() {

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vWorldPosition = worldPosition.xyz;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			gl_Position.z = gl_Position.w; // set z to camera.far

			vSunDirection = normalize( sunPosition );

			vSunE = sunIntensity( dot( vSunDirection, up ) );

			vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

			float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

			// extinction (absorption + out scattering)
			// rayleigh coefficients
			vBetaR = totalRayleigh * rayleighCoefficient;

			// mie coefficients
			vBetaM = totalMie( turbidity ) * mieCoefficient;

		}`,fragmentShader:`
		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		uniform float mieDirectionalG;
		uniform vec3 up;

		// constants for atmospheric scattering
		const float pi = 3.141592653589793238462643383279502884197169;

		const float n = 1.0003; // refractive index of air
		const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

		// optical length at zenith for molecules
		const float rayleighZenithLength = 8.4E3;
		const float mieZenithLength = 1.25E3;
		// 66 arc seconds -> degrees, and the cosine of that
		const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

		// 3.0 / ( 16.0 * pi )
		const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
		// 1.0 / ( 4.0 * pi )
		const float ONE_OVER_FOURPI = 0.07957747154594767;

		float rayleighPhase( float cosTheta ) {
			return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
		}

		float hgPhase( float cosTheta, float g ) {
			float g2 = pow( g, 2.0 );
			float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
			return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
		}

		void main() {

			vec3 direction = normalize( vWorldPosition - cameraPosition );

			// optical length
			// cutoff angle at 90 to avoid singularity in next formula.
			float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
			float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
			float sR = rayleighZenithLength * inverse;
			float sM = mieZenithLength * inverse;

			// combined extinction factor
			vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

			// in scattering
			float cosTheta = dot( direction, vSunDirection );

			float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
			vec3 betaRTheta = vBetaR * rPhase;

			float mPhase = hgPhase( cosTheta, mieDirectionalG );
			vec3 betaMTheta = vBetaM * mPhase;

			vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
			Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

			// nightsky
			float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
			float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
			vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
			vec3 L0 = vec3( 0.1 ) * Fex;

			// composition + solar disc
			float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
			L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

			vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

			vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

			gl_FragColor = vec4( retColor, 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};class Yn{constructor(e,t,i){this.skyControl=e,this.sky=new Pe,this.renderer=i,this.sphereLight=t,this.sky.scale.setScalar(1e5),this.skyControl.turbidity=this.skyControl.turbidity??10,this.skyControl.rayleigh=this.skyControl.rayleigh??2,this.skyControl.mieCoefficient=this.skyControl.mieCoefficient??.005,this.skyControl.mieDirectionalG=this.skyControl.mieDirectionalG??.7;const n=this.sky.material.uniforms;n.turbidity.value=this.skyControl.turbidity,n.rayleigh.value=this.skyControl.rayleigh,n.mieCoefficient.value=this.skyControl.mieCoefficient,n.mieDirectionalG.value=this.skyControl.mieDirectionalG,n.sunPosition.value=new F(0,100,0)}setExposure(e){}tick(){const e=new F().setFromMatrixPosition(this.sphereLight.matrixWorld);e.y<0?this.sphereLight.children[1].visible=!1:this.sphereLight.children[1].visible=!0;const t=this.sky.material.uniforms;t.turbidity.value=this.skyControl.turbidity,t.rayleigh.value=this.skyControl.rayleigh,t.mieCoefficient.value=this.skyControl.mieCoefficient,t.mieDirectionalG.value=this.skyControl.mieDirectionalG,t.sunPosition.value.copy(e),console.log("Sky tick - Sun Pos:",e.toArray(),"Turbidity:",this.skyControl.turbidity)}}var je={exports:{}},Et;function Zn(){return Et||(Et=1,function(c,e){(function(){var t=Math.PI,i=Math.sin,n=Math.cos,a=Math.tan,s=Math.asin,r=Math.atan2,o=Math.acos,l=t/180,h=1e3*60*60*24,d=2440588,u=2451545;function m(y){return y.valueOf()/h-.5+d}function p(y){return new Date((y+.5-d)*h)}function _(y){return m(y)-u}var b=l*23.4397;function w(y,E){return r(i(y)*n(b)-a(E)*i(b),n(y))}function g(y,E){return s(i(E)*n(b)+n(E)*i(b)*i(y))}function T(y,E,C){return r(i(y),n(y)*i(E)-a(C)*n(E))}function A(y,E,C){return s(i(E)*i(C)+n(E)*n(C)*n(y))}function S(y,E){return l*(280.16+360.9856235*y)-E}function D(y){return y<0&&(y=0),2967e-7/Math.tan(y+.00312536/(y+.08901179))}function P(y){return l*(357.5291+.98560028*y)}function H(y){var E=l*(1.9148*i(y)+.02*i(2*y)+3e-4*i(3*y)),C=l*102.9372;return y+E+C+t}function M(y){var E=P(y),C=H(E);return{dec:g(C,0),ra:w(C,0)}}var B={};B.getPosition=function(y,E,C){var k=l*-C,R=l*E,O=_(y),L=M(O),I=S(O,k)-L.ra;return{azimuth:T(I,R,L.dec),altitude:A(I,R,L.dec)}};var he=B.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];B.addTime=function(y,E,C){he.push([y,E,C])};var Ce=9e-4;function Gt(y,E){return Math.round(y-Ce-E/(2*t))}function et(y,E,C){return Ce+(y+E)/(2*t)+C}function tt(y,E,C){return u+y+.0053*i(E)-.0069*i(2*C)}function jt(y,E,C){return o((i(y)-i(E)*i(C))/(n(E)*n(C)))}function Ut(y){return-2.076*Math.sqrt(y)/60}function $t(y,E,C,k,R,O,L){var I=jt(y,C,k),z=et(I,E,R);return tt(z,O,L)}B.getTimes=function(y,E,C,k){k=k||0;var R=l*-C,O=l*E,L=Ut(k),I=_(y),z=Gt(I,R),V=et(0,R,z),W=P(V),Q=H(W),oe=g(Q,0),X=tt(V,W,Q),ee,de,Y,K,te,ue,U={solarNoon:p(X),nadir:p(X-.5)};for(ee=0,de=he.length;ee<de;ee+=1)Y=he[ee],K=(Y[0]+L)*l,te=$t(K,R,O,oe,z,W,Q),ue=X-(te-X),U[Y[1]]=p(ue),U[Y[2]]=p(te);return U};function it(y){var E=l*(218.316+13.176396*y),C=l*(134.963+13.064993*y),k=l*(93.272+13.22935*y),R=E+l*6.289*i(C),O=l*5.128*i(k),L=385001-20905*n(C);return{ra:w(R,O),dec:g(R,O),dist:L}}B.getMoonPosition=function(y,E,C){var k=l*-C,R=l*E,O=_(y),L=it(O),I=S(O,k)-L.ra,z=A(I,R,L.dec),V=r(i(I),a(R)*n(L.dec)-i(L.dec)*n(I));return z=z+D(z),{azimuth:T(I,R,L.dec),altitude:z,distance:L.dist,parallacticAngle:V}},B.getMoonIllumination=function(y){var E=_(y||new Date),C=M(E),k=it(E),R=149598e3,O=o(i(C.dec)*i(k.dec)+n(C.dec)*n(k.dec)*n(C.ra-k.ra)),L=r(R*i(O),k.dist-R*n(O)),I=r(n(C.dec)*i(C.ra-k.ra),i(C.dec)*n(k.dec)-n(C.dec)*i(k.dec)*n(C.ra-k.ra));return{fraction:(1+n(L))/2,phase:.5+.5*L*(I<0?-1:1)/Math.PI,angle:I}};function xe(y,E){return new Date(y.valueOf()+E*h/24)}B.getMoonTimes=function(y,E,C,k){var R=new Date(y);k?R.setUTCHours(0,0,0,0):R.setHours(0,0,0,0);for(var O=.133*l,L=B.getMoonPosition(R,E,C).altitude-O,I,z,V,W,Q,oe,X,ee,de,Y,K,te,ue,U=1;U<=24&&(I=B.getMoonPosition(xe(R,U),E,C).altitude-O,z=B.getMoonPosition(xe(R,U+1),E,C).altitude-O,Q=(L+z)/2-I,oe=(z-L)/2,X=-oe/(2*Q),ee=(Q*X+oe)*X+I,de=oe*oe-4*Q*I,Y=0,de>=0&&(ue=Math.sqrt(de)/(Math.abs(Q)*2),K=X-ue,te=X+ue,Math.abs(K)<=1&&Y++,Math.abs(te)<=1&&Y++,K<-1&&(K=te)),Y===1?L<0?V=U+K:W=U+K:Y===2&&(V=U+(ee<0?te:K),W=U+(ee<0?K:te)),!(V&&W));U+=2)L=z;var Me={};return V&&(Me.rise=xe(R,V)),W&&(Me.set=xe(R,W)),!V&&!W&&(Me[ee>0?"alwaysUp":"alwaysDown"]=!0),Me},c.exports=B})()}(je)),je.exports}var qn=Zn();class Jn{constructor(e,t){this.params=e,this.settings=t,this.date=this.getUTCDate(),this.timeText=document.querySelector(".time"),this.lastHour=this.params.hour,this.sunSphere=new ke(new Pi(.3,32,32),new le({color:16776960})),this.sunSphere.visible=!1,this.sunLight=new Mt(16774630,1),this.sunLight.castShadow=this.settings.shadows,this.sunLight.shadow.mapSize.width=this.settings.shadowMapWidth,this.sunLight.shadow.mapSize.height=this.settings.shadowMapHeight,this.sunLight.shadow.camera.near=.1,this.sunLight.shadow.camera.far=50,this.sunLight.shadow.camera.left=-5,this.sunLight.shadow.camera.right=5,this.sunLight.shadow.camera.top=5,this.sunLight.shadow.camera.bottom=-5,this.sunLight.shadow.bias=-1e-4,this.sunLight.shadow.normalBias=.01,this.sunPathLight=new ce,this.sphereLight=new ce,this.sphereLight.add(this.sunSphere,this.sunLight),this.sunPathLight.add(this.sphereLight,new ce),this.drawSunDayPath(),this.drawSunSurface(),this.drawAnalemmas(),this.updateSunPosition(),this.updateNorth()}getUTCDate(){const t=this.params.month-1,i=this.params.day,n=this.params.minute,a=Math.round(this.params.longitude/15),s=this.params.hour-a;return new Date(Date.UTC(2025,t,i,s,n))}getSunPosition(e){let t=qn.getPosition(e,this.params.latitude,this.params.longitude),i=this.params.radius*Math.cos(t.altitude)*Math.cos(t.azimuth),n=this.params.radius*Math.cos(t.altitude)*Math.sin(t.azimuth),a=this.params.radius*Math.sin(t.altitude);return{x:i,y:a,z:n}}drawAnalemmas(){if(this.params.showAnalemmas){let e=this.sunPathLight.getObjectByName("analemmaPath");this.sunPathLight.remove(e);let t=new ce;for(let i=5;i<20;i++){let n=[],a=new Date(2025,0,1),s=new Date(2026,0,1);for(let h=a;h<s;h.setDate(h.getDate()+1)){let d=new Date(h);d.setUTCHours(i);let u=this.getSunPosition(d);n.push(u.x,u.y,u.z)}let r=new Ae,o=new Fi({color:"yellow",linewidth:1,scale:10,dashSize:6,gapSize:3,transparent:!0,opacity:.7});r.setAttribute("position",new Oe(n,3));let l=new Ke(r,o);l.computeLineDistances(),t.add(l),t.name="analemmaPath"}this.sunPathLight.add(t)}else{let e=this.sunPathLight.getObjectByName("analemmaPath");this.sunPathLight.remove(e)}}drawSunSurface(){if(this.params.showSunSurface){let e=this.sunPathLight.getObjectByName("sunSurface");this.sunPathLight.remove(e);let t=[];for(let s=0;s<6;s++){let r=new Date("2025-01-01T00:00:00Z");for(let o=0;o<24;o++){r=new Date(r),r.setUTCMonth(s),r.setUTCHours(o);let l=this.getSunPosition(r);t.push(l.x,l.y,l.z),r.setUTCHours(o+1);let h=this.getSunPosition(r);t.push(h.x,h.y,h.z),r.setUTCMonth(s+1),r.setUTCHours(o);let d=this.getSunPosition(r);t.push(d.x,d.y,d.z),t.push(d.x,d.y,d.z),t.push(h.x,h.y,h.z),r.setUTCHours(o+1);let u=this.getSunPosition(r);t.push(u.x,u.y,u.z)}}let i=new Ae,n=new le({color:"yellow",side:Pt,transparent:!0,opacity:.1});i.setAttribute("position",new Oe(t,3));let a=new ke(i,n);a.name="sunSurface",this.sunPathLight.add(a)}else{let e=this.sunPathLight.getObjectByName("sunSurface");this.sunPathLight.remove(e)}}updateHour(){const e=Math.round(this.params.longitude/15),t=this.params.hour-e;this.date.setUTCHours(t),this.date.setUTCMinutes(this.params.minute),this.updateSunPosition(),this.sunCalculations&&this.sunCalculations.markAsDirty(),this.lastHour=this.params.hour}updateMonth(){const e=Math.round(this.params.longitude/15),t=this.params.hour-e;this.date.setUTCHours(t),this.date.setUTCDate(this.params.day),this.date.setUTCMonth(this.params.month-1),this.updateSunPosition(),this.drawSunDayPath(),this.sunCalculations&&this.sunCalculations.markAsDirty(),this.lastHour=this.params.hour}updateNorth(){this.sunPathLight.rotation.y=qe.degToRad(this.params.northOffset-90)}updateLocation(){this.drawSunDayPath(),this.drawSunSurface(),this.drawAnalemmas(),this.updateSunPosition(),this.sunCalculations&&this.sunCalculations.markAsDirty()}updateSunPosition(){let e=this.getSunPosition(this.date);this.sphereLight.position.set(e.x,e.y,e.z),this.sunLight.lookAt(0,0,0)}drawSunDayPath(){if(this.params.showSunDayPath){let e=this.sunPathLight.getObjectByName("dayPath");this.sunPathLight.remove(e);let t=new Lt({color:"red",linewidth:5,transparent:!0,opacity:.5}),i=new Ae,n=[];for(let s=0;s<24;s++){let r=new Date(this.date);r.setUTCHours(s);let o=this.getSunPosition(r);n.push(o.x,o.y,o.z)}i.setAttribute("position",new Oe(n,3));let a=new Ke(i,t);a.name="dayPath",this.sunPathLight.add(a)}else{let e=this.sunPathLight.getObjectByName("dayPath");this.sunPathLight.remove(e)}}tick(e){if(this.params.animateTime){let i=new Date(this.date).getTime();this.date=new Date(i+e*1e3*this.params.timeSpeed),this.params.minute=this.date.getUTCMinutes(),this.params.hour=this.date.getUTCHours(),this.params.day=this.date.getUTCDate(),this.params.month=this.date.getUTCMonth()+1,this.updateSunPosition(),this.sunCalculations&&this.sunCalculations.markAsDirty(),Math.floor(this.params.hour)!==this.lastHour&&this.params.showSunDayPath&&(this.drawSunDayPath(),this.lastHour=Math.floor(this.params.hour))}}}class Qn{constructor(e,t,i,n){this.sunLight=e,this.hemisphereLight=t,this.sunPath=i,this.params=n,this.needsUpdate=!0}kelvinToRGB(e){const t=e/100;let i,n,a;return t<=66?i=255:i=329.698727446*Math.pow(t-60,-.1332047592),t<=66?n=99.4708025861*Math.log(t)-161.1195681661:n=288.1221695283*Math.pow(t-60,-.0755148492),t>=66?a=255:t<=19?a=0:a=138.5177312231*Math.log(t-10)-305.0447927307,new f.Color(Math.max(0,Math.min(255,i))/255,Math.max(0,Math.min(255,n))/255,Math.max(0,Math.min(255,a))/255)}markAsDirty(){this.needsUpdate=!0}tick(){if(!this.needsUpdate)return;const e=this.sunPath.getSunPosition(this.sunPath.date),t=Math.asin(e.y/this.params.radius),i=Math.max(0,Math.sin(t)),n=f.MathUtils.lerp(2e3,1e4,i);this.sunLight.color.copy(this.kelvinToRGB(n)),this.sunLight.intensity=f.MathUtils.lerp(.03,10,i),this.hemisphereLight.intensity=f.MathUtils.lerp(.01,1.5,i),console.log("Sun Intensity:",this.sunLight.intensity,"Hemisphere Intensity:",this.hemisphereLight.intensity,"Altitude:",f.MathUtils.radToDeg(t)),this.needsUpdate=!1}}class es{constructor(e){this.world=e,this.lightingMode=this.world.params.lightingMode,this.skyControl={turbidity:5,rayleigh:1,mieCoefficient:.002,mieDirectionalG:.5}}setupSolarMode(){this.sunPath=new Jn(this.world.params,this.world.rendererManager.settings),this.world.scene.add(this.sunPath.sunPathLight),this.dynamicSky=new Yn(this.skyControl,this.sunPath.sphereLight,this.world.renderer),this.world.scene.add(this.dynamicSky.sky),this.dynamicSky.sky.visible=!0,this.world.loop.updatables.push(this.dynamicSky),this.ambientLight=new f.HemisphereLight(8900331,9127187,.2),this.ambientLight.name="hemisphereLight",this.world.scene.add(this.ambientLight),this.sunHelper=new f.DirectionalLightHelper(this.sunPath.sunLight,1),this.sunHelper.visible=!1,this.world.scene.add(this.sunHelper),this.shadowCameraHelper=new f.CameraHelper(this.sunPath.sunLight.shadow.camera),this.shadowCameraHelper.visible=!1,this.world.scene.add(this.shadowCameraHelper),this.sunCalculations=new Qn(this.sunPath.sunLight,this.ambientLight,this.sunPath,this.world.params),this.sunCalculations.tick(),this.sunPath.sunCalculations=this.sunCalculations,this.setLightingMode("sun"),this.world.loop.updatables.push(this.sunCalculations)}enableSunLight(e){if(!this.sunPath){console.warn("sunPath is not initialized yet");return}this.sunPath.sunPathLight.visible=e,this.dynamicSky.sky.visible=e,this.ambientLight.visible=e,this.sunHelper.visible=e&&this.world.params.showSunSurface,this.shadowCameraHelper.visible=e&&!1;const t=[this.sunPath,this.dynamicSky,this.sunCalculations];e?t.forEach(i=>{this.world.loop.updatables.includes(i)||this.world.loop.updatables.push(i)}):this.world.loop.updatables=this.world.loop.updatables.filter(i=>!t.includes(i))}enableSceneLights(e){this.world.sceneManager.currentScene&&(this.world.sceneManager.currentScene.traverse(t=>{t.isLight&&(t.visible=e)}),this.world.spotlightHelper&&(this.world.spotlightHelper.visible=e&&this.world.spotlightHelper.visible))}setLightingMode(e){switch(this.lightingMode=e,e){case"sun":this.enableSunLight(!0),this.enableSceneLights(!1);break;case"scene":this.enableSunLight(!1),this.enableSceneLights(!0);break;case"both":this.enableSunLight(!0),this.enableSceneLights(!0);break;default:console.warn("Invalid lighting mode:",e)}this.world.rendererManager.setExposure(this.world.params.exposure,this.world.sceneManager.currentScene,this.ambientLight,this.dynamicSky),this.world.rendererManager.updateShadows()}}class ts{constructor(e){this.container=e,this.scene=new f.Scene,this.camera=new f.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,2e3),this.camera.rotation.order="YXZ",this.camera.position.set(-5,3,1.6),this.isMobile=/Android|iPhone|iPad/i.test(navigator.userAgent),this.platform=this.isMobile?window.innerWidth>window.innerHeight?"mobileLandscape":"mobilePortrait":"desktop",this.mode="veloce",this.rendererManager=new ln(e,this.camera),this.renderer=this.rendererManager.renderer,this.rendererManager.world=this,this.loadingBar=document.createElement("div"),this.loadingBar.id="loading-bar",this.loadingBar.innerHTML='<div class="progress" data-progress="0"></div>',this.container.appendChild(this.loadingBar),this.loadingManager=new f.LoadingManager,this.loadingManager.onProgress=(t,i,n)=>{const a=Math.round(i/n*100),s=this.loadingBar.querySelector(".progress");s.style.width=`${a}%`,s.setAttribute("data-progress",a)},this.loadingManager.onLoad=()=>this.loadingBar.style.display="none",this.stats=new Di({horizontal:!1,trackGPU:!0}),this.stats.init(this.renderer),this.container.appendChild(this.stats.dom),this.controls=ht(this.camera,this.renderer.domElement),this.loop=new rn(this.camera,this.scene,this.renderer,this.stats),this.loop.setupInteractionListeners(),this.loop.updatables.push(this.controls),this.params={latitude:-23.6072661,longitude:-46.674824,northOffset:0,minute:0,hour:12,day:1,month:1,animateTime:!1,timeSpeed:1,showSunSurface:!1,showAnalemmas:!1,showSunDayPath:!1,radius:25,lightingMode:"scene",currentScene:"test",exposure:.6,toneMapping:"LinearToneMapping"},this.sceneManager=new Xn(this),this.lightingManager=new es(this)}async init(e="ZF00"){this.loadingBar.style.display="block",this.lightingManager.setupSolarMode(),await this.sceneManager.init(e),this.gui=on(this),this.rendererManager.updateShadows(),this.rendererManager.preRenderShadows()}start(){this.loop.start(),this.loop.pauseAfterDelay(1500)}stop(){this.loop.stop()}switchMode(e){let t=document.getElementById("mode-switch-overlay");t||(t=document.createElement("div"),t.id="mode-switch-overlay",document.body.appendChild(t)),t.innerText=`Passando alla modalità ${e}`,t.style.display="block",this.loop.stop(),setTimeout(()=>{const i=this.controls;this.mode=e,this.rendererManager.setMode(e),this.renderer=this.rendererManager.renderer,this.loop.updateRenderer(this.renderer);const n={target:i.target.clone(),position:this.camera.position.clone(),quaternion:this.camera.quaternion.clone(),zoom:this.camera.zoom};i.dispose(),this.controls=ht(this.camera,this.renderer.domElement),this.controls.target.copy(n.target),this.camera.position.copy(n.position),this.camera.quaternion.copy(n.quaternion),this.camera.zoom=n.zoom,this.sceneManager.applyCameraParameters();const a=this.loop.updatables.indexOf(i);a!==-1?this.loop.updatables[a]=this.controls:this.loop.updatables.push(this.controls),this.stats.init(this.renderer),this.rendererManager.updateShadows(),this.rendererManager.setToneMapping(this.params.toneMapping),this.rendererManager.setExposure(this.params.exposure,this.sceneManager.currentScene,this.lightingManager.ambientLight,this.lightingManager.dynamicSky),this.loop.start(),this.loop.pauseAfterDelay(1500),t.style.display="none"},100)}destroy(){this.loop.destroyInteractionListeners(),this.rendererManager.destroy(),this.gui.destroy()}}async function is(){const c=document.querySelector("#scene-container");if(!c){console.error("Error: #scene-container not found in the DOM");return}be.materialCache.clear();const e=new ts(c);await e.init(),e.loop.setupInteractionListeners(),e.start()}document.addEventListener("DOMContentLoaded",()=>{is().catch(c=>{console.error(c)})});
